# ROS2

## 1. ROS2 åŸºç¤ä»‹ç´¹

> æ¨è–¦è³‡æºï¼š[ROS2 åŠ ROS Porting è‡ªå­¸ç­†è¨˜](https://ithelp.ithome.com.tw/articles/10317746)

!!! tip
    ROS2 çš„æ•™å­¸è³‡æºå…¶å¯¦éå¸¸å¤šï¼Œç¤¾ç¾¤ä¹Ÿå¾ˆå»£å¤§ã€‚  
    æœƒé¼“å‹µè®€è€…å¤šå¤šä¸Šç¶²æŸ¥è³‡æ–™ï¼Œé€™ç¯‡åªæœƒåˆ—å‡ºæœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚  
    å¤šçœ‹ç¶²è·¯è³‡æºèƒ½æ›´ç†è§£ä¸Šä¸‹æ–‡ã€‚  

---

### 1-1. ROS ç°¡ä»‹

ROSï¼ˆRobot Operating Systemï¼‰æ˜¯ä¸€å¥—ç‚ºæ©Ÿå™¨äººé–‹ç™¼æ‰€è¨­è¨ˆçš„ä¸­ä»‹è»Ÿé«”æ¶æ§‹ï¼Œ  
æä¾›å¸¸ç”¨å·¥å…·èˆ‡åŠŸèƒ½ï¼Œä¾‹å¦‚é€šè¨Šã€ç¡¬é«”æŠ½è±¡ã€æ¨¡çµ„åŒ–æ¶æ§‹ç­‰ã€‚

ROS2 æ¯å€‹[ç™¼è¡Œç‰ˆï¼ˆdistroï¼‰](https://docs.ros.org/en/dashing/Releases.html)éƒ½å°æ‡‰ç‰¹å®šçš„ Ubuntu ç‰ˆæœ¬ï¼Œ  
å»ºè­°é¸ç”¨ LTSï¼ˆLong Term Supportï¼‰ç‰ˆæœ¬ä»¥ç²å¾—è¼ƒé•·çš„ç¶­è­·èˆ‡ç©©å®šæ€§ã€‚

| ROS2 Distro   | æ”¯æ´ Ubuntu ç‰ˆæœ¬      | LTS æ”¯æ´æœŸé™         |
|---------------|----------------------|----------------------|
| Foxy          | 20.04 (Focal, LTS)   | 2023/05              |
| Galactic      | 20.04 (Focal, LTS)   | 2022/11              |
| Humble        | 22.04 (Jammy, LTS)   | 2027/05 (LTS)        |
| Iron          | 22.04 (Jammy, LTS)   | 2024/11              |
| Jazzy         | 24.04 (Noble, LTS)   | 2029/05 (LTS)        |

!!! tip "ROS Distro é¸æ“‡"

    é–‹ç™¼å°ˆæ¡ˆå„ªå…ˆé¸æ“‡ ROS2 LTS ç‰ˆæœ¬ï¼ˆå¦‚ Humbleã€Jazzyï¼‰åŠå°æ‡‰çš„ Ubuntu LTS ç‰ˆæœ¬ï¼Œä»¥ç¢ºä¿é•·æœŸæ”¯æ´èˆ‡ç›¸å®¹æ€§ã€‚

??? info "ROS1 vs. ROS2"

    ROS1 é›–ç„¶å»£æ³›ä½¿ç”¨ï¼Œä½†åœ¨å¯é æ€§ã€å®‰å…¨æ€§ã€å³æ™‚æ€§ã€å¤šå¹³å°æ”¯æ´ç­‰æ–¹é¢æœ‰æ˜é¡¯é™åˆ¶ã€‚  
    ROS2 å‰‡æ˜¯é‡å°é€™äº›ç¼ºé»é€²è¡Œé‡æ§‹ï¼Œä¸¦å°å…¥äº†å·¥æ¥­ç•Œæ¨™æº–çš„ DDS æ¶æ§‹ã€‚

    **ROS1 èˆ‡ ROS2 çš„å·®ç•°æ¯”è¼ƒï¼š**

    | ç‰¹æ€§             | ROS1                          | ROS2                              |
    |------------------|-------------------------------|-----------------------------------|
    | é€šè¨Šæ©Ÿåˆ¶         | åŸºæ–¼ TCP/UDP è‡ªè¨‚å”å®š         | åŸºæ–¼ DDS æ¨™æº–                     |
    | å¤šå¹³å°æ”¯æ´       | åƒ…æ”¯æ´ Linux ç‚ºä¸»              | æ”¯æ´ Linuxã€Windowsã€macOS       |
    | å¯¦æ™‚æ€§æ”¯æ´       | ä¸æ”¯æ´                         | å¯é€é DDS è¨­å®šå¯¦ç¾åŸºæœ¬å¯¦æ™‚æ€§    |
    | å®‰å…¨æ€§           | å¹¾ä¹ç„¡å…§å»ºå®‰å…¨æ€§               | DDS æä¾›åŠ å¯†èˆ‡å­˜å–æ§åˆ¶æ©Ÿåˆ¶       |
    | æ¨¡çµ„å•Ÿå‹•èˆ‡æ§åˆ¶   | ä¸æ”¯æ´ Lifecycle               | æ”¯æ´ Lifecycle èˆ‡ç‹€æ…‹æ©Ÿ           |

    é›–ç„¶ ROS2 æ”¯æ´ Linux ä»¥å¤–çš„ OSï¼Œ ä½†é‚„æ˜¯ç›¡é‡è·‘åœ¨ Linux OSã€‚

---

### 1-2. ROS2 æ ¸å¿ƒæ¦‚å¿µ

| æ ¸å¿ƒæ¦‚å¿µ                | èªªæ˜                                                                 |
|----------------------|----------------------------------------------------------------------|
| Node                 | ROS2 ä¸­çš„æœ€å°é‹ä½œå–®å…ƒï¼Œè² è²¬ç‰¹å®šä»»å‹™çš„ç¨‹å¼ï¼ˆå¦‚æ„Ÿæ¸¬ã€æ§åˆ¶ã€é€šè¨Šç­‰ï¼‰ã€‚         |
| Topic                | éåŒæ­¥è³‡æ–™æµé€šé“ï¼ŒPublisher ç™¼å¸ƒã€Subscriber è¨‚é–±ï¼Œé©åˆæŒçºŒæ€§è³‡æ–™å‚³éã€‚      |
| Service              | åŒæ­¥è«‹æ±‚/å›æ‡‰é€šè¨Šï¼ŒClient ç™¼é€è«‹æ±‚ã€Server å›å‚³çµæœï¼Œé©åˆçŸ­æš«æ€§ä»»å‹™ã€‚        |
| Action               | é©åˆéœ€å›å ±é€²åº¦æˆ–å¯ä¸­æ–·çš„é•·æ™‚é–“ä»»å‹™ï¼ˆå¦‚å°èˆªï¼‰ï¼Œæ”¯æ´ç›®æ¨™ã€å–æ¶ˆã€ç‹€æ…‹å›å ±ã€‚     |
| Publisher/Subscriber | ä¸€å°å¤šã€å¤šå°å¤šçš„è¨Šæ¯ç™¼å¸ƒèˆ‡æ¥æ”¶æ©Ÿåˆ¶ï¼Œå¯¦ç¾è³‡æ–™åˆ†ç™¼ã€‚                        |
| Message              | å®šç¾©ç¯€é»é–“é€šè¨Šçš„è³‡æ–™çµæ§‹ï¼ˆå¦‚ std_msgs/Stringï¼‰ï¼Œå¯è‡ªè¨‚å‹åˆ¥ä»¥å‚³éè¤‡é›œè³‡æ–™ã€‚   |
| tf2 åº§æ¨™è½‰æ›ç³»çµ±      | ç®¡ç†å¤šå€‹åº§æ¨™ç³»ä¹‹é–“çš„é—œä¿‚èˆ‡è½‰æ›ï¼Œå¸¸ç”¨æ–¼æ©Ÿå™¨äººé‹å‹•å­¸ã€‚                       |
| Parameter            | å¯æ–¼åŸ·è¡Œæ™‚å‹•æ…‹è¨­å®šã€æŸ¥è©¢ã€èª¿æ•´çš„åƒæ•¸ï¼Œæ”¯æ´ç¯€é»è¡Œç‚ºå½ˆæ€§åŒ–ã€‚                  |
| Lifecycle            | ç¯€é»ç”Ÿå‘½é€±æœŸç®¡ç†æ©Ÿåˆ¶ï¼Œä¾¿æ–¼æ§åˆ¶å•Ÿå‹•ã€æš«åœã€é‡å•Ÿç­‰ç‹€æ…‹ï¼Œæå‡ç³»çµ±ç©©å®šæ€§ã€‚       |

---

### 1-3. ROS2 Middleware

![](../assets/ros2/arch.jpg){width="700"}

* **DDS (Data Distribution Service)**ï¼š

    - ROS2 çš„é è¨­ä¸­ä»‹ç³»çµ±ï¼ˆä¾‹å¦‚ Fast DDSã€Cyclone DDS ç­‰ï¼‰
    - æ”¯æ´ QoSï¼ˆQuality of Serviceï¼‰è¨­å®šï¼Œå¦‚å¯é æ€§ã€å»¶é²ã€ä¿ç•™æ­·å²ç­‰
    - åˆ†æ•£å¼æ¶æ§‹ï¼Œä¸éœ€ä¸­å¤® Master ç®¡ç†

* **RMWï¼ˆROS Middleware Interfaceï¼‰å±¤**ï¼š

    - æŠ½è±¡å±¤ï¼Œæä¾› ROS2 èˆ‡ DDS çš„ä»‹æ¥
    - å…è¨±ä¸åŒ DDS å¯¦ä½œï¼ˆå¦‚ Fast DDSã€RTI Connextï¼‰åˆ‡æ›è€Œä¸æ›´æ”¹ä¸Šå±¤ç¨‹å¼ç¢¼

---

### 1-4. å¸¸è¦‹é€šè¨Šæ©Ÿåˆ¶

ROS2 æä¾›ä¸‰ç¨®ä¸»è¦çš„ç¯€é»é–“é€šè¨Šæ©Ÿåˆ¶ï¼š  

* Publish-Subscribe
* Service-Client
* Action

å®ƒå€‘å„è‡ªé©ç”¨æ–¼ä¸åŒçš„æ‡‰ç”¨å ´æ™¯ã€‚

| æ©Ÿåˆ¶         | æ¶æ§‹èˆ‡æ©Ÿåˆ¶                                                                                       | è³‡æ–™æµç‰¹æ€§   | å›æ‡‰æ–¹å¼         | é©ç”¨æƒ…å¢ƒ                                         |
|--------------|--------------------------------------------------------------------------------------------------|--------------|------------------|--------------------------------------------------|
| Pub-Sub      | ç¯€é»é€é Topic é€²è¡ŒéåŒæ­¥è³‡æ–™å‚³éï¼ŒPublisher ç™¼å¸ƒã€Subscriber è¨‚é–±ï¼Œä¸€å°å¤šæˆ–å¤šå°å¤šï¼Œè³‡æ–™æŒçºŒæµå‹•ã€‚ | éåŒæ­¥       | ç„¡å›æ‡‰           | æ„Ÿæ¸¬å™¨æ•¸æ“šã€ç‹€æ…‹å›å ±ã€å³æ™‚ç›£æ§ï¼ˆå¦‚é›·é”ã€å½±åƒï¼‰    |
| Srv-Cli      | æ¡åŒæ­¥è«‹æ±‚/å›æ‡‰æ¨¡å¼ï¼ŒClient ç™¼é€è«‹æ±‚ï¼ŒServer è™•ç†ä¸¦å›å‚³çµæœï¼Œä¸€æ¬¡è«‹æ±‚å°æ‡‰ä¸€æ¬¡å›æ‡‰ã€‚               | åŒæ­¥         | å–®æ¬¡å›æ‡‰         | æŸ¥è©¢åƒæ•¸ã€è¨­å®šå€¼ã€å–®æ¬¡æ§åˆ¶ï¼ˆå¦‚æ‹ç…§ã€é–‹é—œè¨­å‚™ï¼‰    |
| Action       | é©åˆé•·æ™‚é–“ã€å¯ä¸­æ–·ã€éœ€å›å ±é€²åº¦çš„ä»»å‹™ï¼ŒClient ç™¼é€ç›®æ¨™ï¼ŒServer å›å ±é€²åº¦ã€çµæœï¼Œæ”¯æ´å–æ¶ˆã€‚           | éåŒæ­¥       | é€²åº¦+çµæœ+å–æ¶ˆ   | å°èˆªã€ç§»å‹•ã€è¤‡é›œæ“ä½œï¼ˆå¦‚è·¯å¾‘è¦åŠƒã€é•·æ™‚é–“é‹ç®—ï¼‰    |

---

## 2. ç’°å¢ƒæº–å‚™

!!! abstract "é–‹ç™¼é ˆçŸ¥"

    æ‰€æœ‰çš„è»Ÿé«”éƒ½å¿…é ˆä½¿ç”¨ Docker é–‹ç™¼ï¼Œä¸è¦ç›´æ¥åœ¨ Host Machine ä¸Šå®‰è£å¥—ä»¶ã€‚

---

### 2-1. ROS2 Docker

é¦–å…ˆæ˜¯ ROS å®˜æ–¹æä¾›çš„ Image æœ‰ä»¥ä¸‹å¹¾ç¨®ç‰ˆæœ¬ã€‚  

å­¸ç¿’éšæ®µï¼Œå¯ä»¥ä½¿ç”¨ `ros:humble-desktop-full` é¿å…ç¼ºå°‘ä¾è³´å¥—ä»¶çš„éŒ¯èª¤ã€‚  
ä½†é–‹ç™¼éšæ®µï¼Œè€ƒæ…®åˆ° Docker æ¸›è‚¥ï¼Œæœ€å¥½æ˜¯å¾ `ros:<distro>-base` é–‹å§‹å®‰è£å¿…è¦å·¥å…·ã€‚


!!! info "ROS2 Official"

    | Image åç¨±                  | å…§å®¹ç°¡ä»‹                                                         | é©ç”¨æƒ…å¢ƒ                   |
    |-----------------------------|------------------------------------------------------------------|----------------------------|
    | `ros:<distro>-base`         | åƒ…å«æœ€åŸºç¤çš„ ROS å®‰è£                                            | è‡ªè¨‚éœ€æ±‚ã€æœ€å°åŒ–æ˜ åƒæª”     |
    | `ros:<distro>-core`        | å«é–‹ç™¼å·¥å…·èˆ‡ç·¨è­¯å™¨                                               | Package é–‹ç™¼               |
    | `ros:<distro>-desktop`      | å« GUI å·¥å…·ï¼ˆå¦‚ RVizï¼‰                                           | æ¨¡æ“¬ã€ä¸€èˆ¬é–‹ç™¼             |
    | `ros:<distro>-desktop-full` | å®Œæ•´ç‰ˆæœ¬ã€‚</br>å«æ¨¡æ“¬å™¨ï¼ˆå¦‚ Gazeboï¼‰ã€ç¯„ä¾‹å¥—ä»¶ç­‰                    | éœ€è¦å®Œæ•´åŠŸèƒ½èˆ‡æ¨¡æ“¬ç’°å¢ƒ     |

??? info "ROS2 Official vs. osrf"

    é™¤äº†å®˜æ–¹ Imageï¼Œä¹Ÿå¯ä»¥åƒè€ƒçœ‹çœ‹ osrf çš„ç‰ˆæœ¬ã€‚

    | é …ç›®                   | ROS å®˜æ–¹ Docker Image (`ros:`)             | OSRF Docker Image (`osrf/ros:`)            |
    |------------------------|--------------------------------------------|--------------------------------------------|
    | ç¶­è­·å–®ä½               | Canonical & Open Roboticsï¼ˆå®˜æ–¹ï¼‰         | OSRFï¼ˆOpen Source Robotics Foundationï¼‰    |
    | Docker Hub ä½ç½®        | https://hub.docker.com/_/ros              | https://hub.docker.com/r/osrf/ros          |
    | ç™¼å¸ƒé »ç‡               | ç©©å®šã€å°é½Š ROS ç™¼å¸ƒç¯€å¥                   | æœ‰æ™‚æœƒæå‰æ¸¬è©¦æ–°ç‰ˆæœ¬                        |
    | æ”¯æ´ç‰ˆæœ¬               | å…¨ç‰ˆæœ¬</br>ï¼ˆbaseã€coreã€desktopã€fullï¼‰      | éƒ¨åˆ†ä»¥ `desktop` ç‚ºä¸»ï¼Œ</br>ä¹Ÿæœ‰ dev images     |
    | å®‰è£æ–¹å¼               | ä½¿ç”¨ `apt` å®‰è£ ROS å¥—ä»¶                  | æœ‰æ™‚ä½¿ç”¨ `rosinstall_generator` æˆ–è‡ªå»º      |
    | æ˜ åƒå¤§å°               | è¼ƒå°ï¼ˆè¦–ç‰ˆæœ¬è€Œå®šï¼‰                        | æœ‰æ™‚åŒ…å«å¤šé¤˜ dev å·¥å…·ï¼Œè¼ƒå¤§                |
    | é©åˆæƒ…å¢ƒ               | æ­£å¼é–‹ç™¼èˆ‡éƒ¨ç½²ç”¨                          | æ¸¬è©¦ã€CI/CDã€è‡ªè¨‚æ§‹å»ºéœ€æ±‚                   |
    | é¡åƒçµæ§‹               | åŸºæ–¼ Ubuntu å®˜æ–¹æ˜ åƒæ§‹å»º                  | æœ‰äº›ç‰ˆæœ¬æ˜¯å¤šéšæ®µæ§‹å»ºï¼Œåå‘é–‹ç™¼ç”¨é€”          |
    | æ–‡ä»¶èˆ‡èªªæ˜             | å®˜æ–¹ ROS Wikiã€Docker Hub</br>èªªæ˜å®Œæ•´        | ç›¸å°è¼ƒå°‘ã€éœ€æŸ¥ GitHub æˆ–ç¤¾ç¾¤èªªæ˜            |


!!! example "Checkpoint"

    é¸æ“‡ä¸€å€‹ ROS2 Docker Imageï¼Œä¸¦ä¸”é€²å…¥åˆ° Container å…§æº–å‚™é–‹ç™¼ã€‚  
    ç‚ºäº†å­¸ç¿’æ–¹ä¾¿ï¼Œè«‹åœ¨ docker compose ä¸­ volume ç©ºè³‡æ–™å¤¾åˆ° container å…§éƒ¨ï¼š`~/colcon_ws:/root/colcon_ws` ã€‚  
    å¦‚æœä¸æœƒæ“ä½œï¼Œè«‹å›é ­åƒé–± [docker-compose](http://localhost:8000/hrc-tech-docs/oweek/4.docker/#4-docker-compose)ã€‚

---

### 2-2. ROS2 Workspace æ¦‚å¿µ

ROS2 ä½¿ç”¨å·¥ä½œå€ï¼ˆworkspaceï¼‰ä¾†ç®¡ç†ç¨‹å¼ç¢¼èˆ‡å¥—ä»¶ï¼Œæœ€åŸºæœ¬çš„çµæ§‹å¦‚ä¸‹ï¼š

``` yaml
ros2_ws/                # ROS2 å·¥ä½œå€ä¸»ç›®éŒ„
â”œâ”€â”€ build/              # ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰colcon å»ºæ§‹ä¸­é–“ç”¢ç‰©ï¼ˆCMake build filesï¼‰
â”œâ”€â”€ install/            # ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰å®‰è£å¾Œçš„åŸ·è¡Œæª”èˆ‡è¨­å®šæª”ï¼ˆsource æ­¤è³‡æ–™å¤¾ä»¥ä½¿ç”¨å¥—ä»¶ï¼‰
â”œâ”€â”€ log/                # ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰å»ºæ§‹éç¨‹çš„æ—¥èªŒï¼ˆç·¨è­¯éŒ¯èª¤èˆ‡è¼¸å‡ºç´€éŒ„ï¼‰
â””â”€â”€ src/                # åŸå§‹ç¢¼æ”¾ç½®è™•ï¼šæ”¾ç½® ROS2 packages
    â”œâ”€â”€ my_robot_pkg/   # è‡ªè¨‚æˆ–ä¸‹è¼‰çš„ ROS2 package
    â””â”€â”€ example_pkg/    # å¯ä»¥æœ‰å¤šå€‹ ROS2 packages
```

æœ‰äº›ç›®éŒ„æ˜¯ç”± ROS2 çš„å»ºç½®å·¥å…· `colcon` ç”Ÿæˆçš„ï¼Œé–‹ç™¼ä¸­ä¸éœ€è¦ä½¿ç”¨åˆ°ä»–å€‘ã€‚

å†å¾€ä¸‹è¿½æº¯åˆ° ROS2 Package çš„å…§éƒ¨çµæ§‹ï¼Œä¹Ÿæ˜¯éµå¾ªè‘—ä¸€å®šçš„æ¶æ§‹ã€‚  
ROS2 Package å¯ç”¨ `C++` æˆ–æ˜¯ `Python` èªè¨€æ’°å¯«ï¼Œæª”æ¡ˆæ¶æ§‹ä¸Šæœƒæœ‰äº›è¨±ä¸åŒï¼š

=== "ğŸ“„ `C++ Package æ¶æ§‹`"

    ``` yaml
    cpp_robot_pkg/
    â”œâ”€â”€ CMakeLists.txt                  # ROS2 CMake å»ºæ§‹è…³æœ¬ï¼Œç·¨è­¯èˆ‡å®‰è£è¦å‰‡å®šç¾©
    â”œâ”€â”€ package.xml                     # ROS2 å¥—ä»¶æè¿°æª”ï¼Œå®£å‘Šä¾è³´ã€ä½œè€…ç­‰è³‡è¨Š
    â”œâ”€â”€ launch/
    â”‚   â””â”€â”€ cpp_robot.launch.py         # ä½¿ç”¨ Python æ’°å¯«çš„å•Ÿå‹•æª”ï¼Œå•Ÿå‹•ç¯€é»ç”¨
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ cpp_robot_node.cpp          # ç¯€é»ä¸»ç¨‹å¼ (C++ æ’°å¯«)ï¼Œé€šå¸¸å« main()
    â”œâ”€â”€ include/
    â”‚   â””â”€â”€ cpp_robot_pkg/
    â”‚       â””â”€â”€ cpp_robot_node.hpp      # å°æ‡‰çš„ C++ æ¨™é ­æª”ï¼Œå®šç¾©é¡åˆ¥èˆ‡ä»‹é¢
    â””â”€â”€ config/
        â””â”€â”€ params.yaml                 # åƒæ•¸æª”ï¼Œä¾›ç¯€é»åœ¨å•Ÿå‹•æ™‚è¼‰å…¥è¨­å®šå€¼
    ```

=== "ğŸ“„ `Python Package æ¶æ§‹`"

    ``` yaml
    py_robot_pkg/
    â”œâ”€â”€ package.xml                 # ROS2 å¥—ä»¶æè¿°æª”ï¼Œå®£å‘Šä¾è³´ã€åŸ·è¡Œé»ã€æˆæ¬Šç­‰
    â”œâ”€â”€ setup.py                    # Python å®‰è£è…³æœ¬ï¼Œå®£å‘Šå¥—ä»¶çµæ§‹èˆ‡ entry_points
    â”œâ”€â”€ setup.cfg                   # è£œå……è¨­å®šæª”ï¼Œç°¡åŒ– setup.py çš„æ ¼å¼å®šç¾©
    â”œâ”€â”€ resource/
    â”‚   â””â”€â”€ py_robot_pkg            # ament æ‰€éœ€ï¼Œç”¨ä¾†æ¨™ç¤ºç‚ºå¯ç™¼ä½ˆå¥—ä»¶ï¼ˆç©ºæª”å³å¯ï¼‰
    â”œâ”€â”€ py_robot_pkg/
    â”‚   â”œâ”€â”€ __init__.py             # Python å¥—ä»¶åˆå§‹åŒ–ï¼ˆå¯ç•™ç©ºï¼‰
    â”‚   â””â”€â”€ py_robot_node.py        # ç¯€é»ä¸»ç¨‹å¼ (Python æ’°å¯«)ï¼Œå« rclpy ç¨‹å¼ç¢¼
    â”œâ”€â”€ launch/
    â”‚   â””â”€â”€ py_robot.launch.py      # å•Ÿå‹•æª”ï¼Œå®šç¾©å¦‚ä½•å•Ÿå‹•æ­¤ Python ç¯€é»
    â””â”€â”€ config/
        â””â”€â”€ params.yaml             # åƒæ•¸è¨­å®šæª”ï¼Œä»¥ YAML æ ¼å¼å®šç¾©åƒæ•¸å€¼
    ```

!!! warning "ROS2 ç·¨è­¯å·¥å…· colcon"
    
    æ³¨æ„ä»¥ä¸Šæ–‡ä»¶ä¸­æœ‰å¾ˆå¤šæ˜¯ä¾é  ROS2 çš„ç·¨è­¯å·¥å…· `colcon` å»ºç«‹æˆ–ç·¨è­¯çš„ç”¢ç‰©ï¼Œ  
    å› æ­¤è«‹è·Ÿè‘—æ­¥é©Ÿä½¿ç”¨å·¥å…·å»ºç«‹æª”æ¡ˆï¼Œè€Œä¸è¦è‡ªå·±å¾’æ‰‹æ–°å¢æª”æ¡ˆï¼Œå¦å‰‡å¯èƒ½æœƒç·¨è­¯æˆ–åŸ·è¡ŒéŒ¯èª¤ã€‚  

!!! example "Checkpoint"

    ç†è§£ Workspace æ¶æ§‹ï¼Œä¸¦ä¸”èƒ½åˆ†è¾¨ `workspace/src` å’Œ `package/src` çš„å·®ç•°ã€‚

---

## 3. ROS2 åŸºç¤åŠŸèƒ½å¯¦ä½œ

!!! abstract "å¯¦ä½œå…§å®¹"

    å¾ä¹¾æ·¨çš„ ROS2 Workspace æ­å»ºä¸åŒåŠŸèƒ½çš„ Nodeï¼Œä¸¦ç·¨è­¯ã€åŸ·è¡Œã€‚

---

### 3-1. å»ºç«‹ Workspace

!!! warning "ä½ å·²ç¶“åœ¨ Container å…§äº†å—?"

    å¾ŒçºŒæ“ä½œéƒ½æ˜¯åœ¨ Docker Container å…§åŸ·è¡Œï¼Œä¸è¦æ±™æŸ“åˆ°å®¿ä¸»æ©Ÿç’°å¢ƒï¼

å»ºç«‹ Workspace ç›®éŒ„ï¼š

``` yaml
mkdir -p ~/colcon_ws/src
src ~/colcon_ws
```

---

### 3-2. æ’°å¯« Publisher / Subscriber Node

1. å»ºç«‹ Packageï¼Œä»¥ä¸‹åˆ†ç‚º C++ å’Œ Python å…©ç¨®ç‰ˆæœ¬ï¼š

    === "C++"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_cmake cpp_pubsub --dependencies rclcpp std_msgs
        ```

    === "Python"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_python py_pubsub --dependencies rclpy std_msgs
        ```

    !!! warning "ros2 package å‘½åè¦å‰‡"

        å‘½åæ™‚è«‹éµå®ˆä»¥ä¸‹è¦ç¯„ï¼š

        - å¿…é ˆå…¨éƒ¨å°å¯«å­—æ¯ï¼ˆa-zï¼‰ï¼Œå¯åŒ…å«æ•¸å­—ï¼ˆ0-9ï¼‰èˆ‡åº•ç·šï¼ˆ_ï¼‰
        - ä¸å¯åŒ…å«å¤§å¯«å­—æ¯ã€ç ´æŠ˜è™Ÿï¼ˆ-ï¼‰ã€ç©ºæ ¼æˆ–ç‰¹æ®Šç¬¦è™Ÿ
        - å¿…é ˆä»¥å­—æ¯é–‹é ­
        - åƒè€ƒå®˜æ–¹å‘½åæ…£ä¾‹ï¼Œé¿å…èˆ‡ç¾æœ‰å¥—ä»¶é‡å

        e.g `realsense_ros`ã€`koch_ros2_wrapper`


2. æ’°å¯« Publisher å’Œ Subscriber Node åŠç›¸é—œé…ç½®ï¼Œä¹Ÿæä¾› C++ å’Œ Python ç‰ˆæœ¬ï¼š

    !!! abstract

        talker å°‡å®šæ™‚ç™¼ä½ˆ message åˆ° topic ä¸Šé¢ï¼Œä¸¦ä¸”ç”± listener æ¥æ”¶è©² topicã€‚

    æª”æ¡ˆæ¶æ§‹ï¼š

    === "C++"

        ``` yaml
        cpp_pubsub/
        â”œâ”€â”€ CMakeLists.txt                # CMake ç·¨è­¯é…ç½®æª”
        â”œâ”€â”€ package.xml                   # ROS2 å¥—ä»¶è³‡è¨Šèˆ‡ä¾è³´è¨­å®š
        â””â”€â”€ src/
            â”œâ”€â”€ talker.cpp                # Publisher node ä¸»ç¨‹å¼
            â””â”€â”€ listener.cpp              # Subscriber node ä¸»ç¨‹å¼
        ```
        
    === "Python"

        ``` yaml
        py_pubsub/
        â”œâ”€â”€ package.xml                   # ROS2 å¥—ä»¶è³‡è¨Šèˆ‡ä¾è³´è¨­å®š
        â”œâ”€â”€ setup.py                      # Python å®‰è£è…³æœ¬ï¼Œè¨­å®š entry_points
        â”œâ”€â”€ resource/
        â”‚   â””â”€â”€ py_pubsub                 # æ¨™è¨˜ç‚º ROS2 å¥—ä»¶ï¼ˆç©ºæª”å³å¯ï¼‰
        â”œâ”€â”€ py_pubsub/
        â”‚   â”œâ”€â”€ __init__.py               # Python å¥—ä»¶åˆå§‹åŒ–ï¼ˆå¯ç•™ç©ºï¼‰
        â”‚   â”œâ”€â”€ talker.py                 # Publisher node ä¸»ç¨‹å¼
        â”‚   â””â”€â”€ listener.py               # Subscriber node ä¸»ç¨‹å¼
        ```

    ç¨‹å¼ç¢¼ï¼š

    === "C++"

        === "ğŸ“„ `talker.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "std_msgs/msg/string.hpp"
            #include <chrono>

            using namespace std::chrono_literals;

            class Talker : public rclcpp::Node {
            public:
                Talker() : Node("talker_node") {
                    publisher_ = this->create_publisher<std_msgs::msg::String>("chatter", 10);
                    timer_ = this->create_wall_timer(500ms, std::bind(&Talker::timer_callback, this));
                }

            private:
                void timer_callback() {
                    auto msg = std_msgs::msg::String();
                    msg.data = "Hello, ROS2!";
                    RCLCPP_INFO(this->get_logger(), "Publishing: '%s'", msg.data.c_str());
                    publisher_->publish(msg);
                }

                rclcpp::Publisher<std_msgs::msg::String>::SharedPtr publisher_;
                rclcpp::TimerBase::SharedPtr timer_;
            };

            int main(int argc, char *argv[]) {
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<Talker>());
                rclcpp::shutdown();
                return 0;
            }

            ```

        === "ğŸ“„ `listener.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "std_msgs/msg/string.hpp"

            class Listener : public rclcpp::Node {
            public:
                Listener() : Node("listener_node") {
                    subscription_ = this->create_subscription<std_msgs::msg::String>(
                    "chatter", 10,
                    [this](const std_msgs::msg::String::SharedPtr msg) {
                        RCLCPP_INFO(this->get_logger(), "Received: '%s'", msg->data.c_str());
                    });
                }

            private:
                rclcpp::Subscription<std_msgs::msg::String>::SharedPtr subscription_;
            };

            int main(int argc, char *argv[]) {
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<Listener>());
                rclcpp::shutdown();
                return 0;
            }
            ```

        === "ğŸ“„ `CMakeLists.txt`"

            ``` yaml linenums="1"
            cmake_minimum_required(VERSION 3.8)
            project(cpp_pubsub)

            find_package(ament_cmake REQUIRED)
            find_package(rclcpp REQUIRED)
            find_package(std_msgs REQUIRED)

            add_executable(talker src/talker.cpp)
            ament_target_dependencies(talker rclcpp std_msgs)

            add_executable(listener src/listener.cpp)
            ament_target_dependencies(listener rclcpp std_msgs)

            install(TARGETS talker listener DESTINATION lib/${PROJECT_NAME})

            ament_package()
            ```
            
        === "ğŸ“„ `package.xml`"

            ``` xml linenums="1"
            <?xml version="1.0"?>
            <package format="3">
                <name>cpp_pubsub</name>
                <version>0.0.0</version>
                <description>C++ publisher/subscriber example</description>
                <maintainer email="your_email@example.com">Your Name</maintainer>
                <license>Apache License 2.0</license>

                <buildtool_depend>ament_cmake</buildtool_depend>
                <exec_depend>rclcpp</exec_depend>
                <exec_depend>std_msgs</exec_depend>

                <export>
                    <build_type>ament_cmake</build_type>
                </export>
            </package>
            ```        
    === "Python"

        === "ğŸ“„ `talker.cpp`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from std_msgs.msg import String

            class Talker(Node):
                def __init__(self):
                    super().__init__('talker_node')
                    self.publisher_ = self.create_publisher(String, 'chatter', 10)
                    self.timer = self.create_timer(0.5, self.timer_callback)

                def timer_callback(self):
                    msg = String()
                    msg.data = 'Hello from Python!'
                    self.get_logger().info(f'Publishing: "{msg.data}"')
                    self.publisher_.publish(msg)

            def main(args=None):
                rclpy.init(args=args)
                node = Talker()
                rclpy.spin(node)
                node.destroy_node()
                rclpy.shutdown()

            if __name__ == '__main__':
                main()

            ```

        === "ğŸ“„ `listener.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from std_msgs.msg import String

            class Listener(Node):
                def __init__(self):
                    super().__init__('listener_node')
                    self.subscription = self.create_subscription(
                        String,
                        'chatter',
                        self.listener_callback,
                        10)

                def listener_callback(self, msg):
                    self.get_logger().info(f'Received: "{msg.data}"')

            def main(args=None):
                rclpy.init(args=args)
                node = Listener()
                rclpy.spin(node)
                node.destroy_node()
                rclpy.shutdown()

            if __name__ == '__main__':
                main()
            ```

        === "ğŸ“„ `setup.py`"

            ``` py linenums="1"
            from setuptools import setup

            package_name = 'py_pubsub'

            setup(
                name=package_name,
                version='0.0.0',
                packages=[package_name],
                entry_points={
                    'console_scripts': [
                        'talker = py_pubsub.talker:main',
                        'listener = py_pubsub.listener:main',
                    ],
                },
                install_requires=['setuptools'],
                zip_safe=True,
                maintainer='your_name',
                description='Python publisher/subscriber example',
            )
            ```

        === "ğŸ“„ `package.xml`"

            ``` xml linenums="1"
            <?xml version="1.0"?>
            <package format="3">
                <name>py_pubsub</name>
                <version>0.0.0</version>
                <description>Python publisher/subscriber example</description>
                <maintainer email="your_email@example.com">Your Name</maintainer>
                <license>Apache License 2.0</license>

                <buildtool_depend>ament_python</buildtool_depend>
                <exec_depend>rclpy</exec_depend>
                <exec_depend>std_msgs</exec_depend>

                <export>
                    <build_type>ament_python</build_type>
                </export>
            </package>
            ```

    !!! example "Checkpoint"

        1. è‡ªè¡Œç†è§£ç¨‹å¼ç¢¼çš„æ¶µç¾©ã€‚
        2. ç¯„ä¾‹ä½¿ç”¨çš„ message type ç‚ºä½•? é€™å€‹ message çš„çµæ§‹æ˜¯ä»€éº¼?

3. ä½¿ç”¨ `colcon` å·¥å…·ç·¨è­¯å·¥ä½œå€ã€‚

    === "C++"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select cpp_pubsub --symlink-install
        ```

    === "Python"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select py_pubsub --symlink-install
        ```

    ç·¨è­¯å®Œæˆå¾Œï¼Œä½¿ç”¨ `source` å®‰è£ç’°å¢ƒï¼š

    ``` yaml
    source install/setup.bash
    ```

    ??? info "`colcon build` å¸¸è¦‹åƒæ•¸"

        | åƒæ•¸                                        | èªªæ˜                                                |
        | ----------------------------------------- | ------------------------------------------------- |
        | `--packages-select`                       | åªç·¨è­¯ç‰¹å®šå¥—ä»¶ã€‚                                          |
        | `--symlink-install`                       | å° Python å¥—ä»¶å»ºç«‹ç¬¦è™Ÿé€£çµï¼Œé–‹ç™¼æ™‚ä¸éœ€é‡è¤‡ç·¨è­¯ã€‚</br>å¼·çƒˆæ¨è–¦ç”¨åœ¨é–‹ç™¼ä¸­ã€‚           |
        | `--packages-up-to`                        | ç·¨è­¯æŸå€‹å¥—ä»¶åŠå…¶æ‰€æœ‰ç›¸ä¾å¥—ä»¶ã€‚                                   |
        | `--parallel-workers N`                    | æŒ‡å®šåŒæ™‚ç·¨è­¯æ•¸é‡ã€‚</br>é€šå¸¸èˆ‡ CPU æ•¸é‡ç›¸åŒã€‚ |
        | `--event-handlers console_direct+`        | æ›´æ¸…æ™°å³æ™‚é¡¯ç¤º logã€‚</br>æ¨è–¦åœ¨ debug ç·¨è­¯éŒ¯èª¤æ™‚ä½¿ç”¨ã€‚                    |
        | `--cmake-args -DCMAKE_BUILD_TYPE=Release` | å‚³éçµ¦ CMake çš„åƒæ•¸ã€‚</br>ä¾‹å¦‚æŒ‡å®š Release æ¨¡å¼ä¾†æå‡æ•ˆèƒ½ã€‚               |
        | `--continue-on-error`                     | è‹¥éƒ¨åˆ†å¥—ä»¶å¤±æ•—ä»ç¹¼çºŒç·¨è­¯å…¶ä»–å¥—ä»¶</br>ï¼ˆé©åˆ batch buildï¼‰ã€‚                 |

    !!! warning "å»ºæ§‹å¸¸è¦‹å•é¡Œ & å»ºè­°"

        1. è‹¥å¥—ä»¶åç¨±æ‹¼éŒ¯ï¼Œ`--packages-select` æœƒç›´æ¥å¿½ç•¥è©²å¥—ä»¶ï¼Œç„¡ä»»ä½•éŒ¯èª¤è¨Šæ¯ã€‚

        2. ä½¿ç”¨ `--symlink-install` å¾Œï¼Œå¦‚æœä½ ä¿®æ”¹äº† Python æª”æ¡ˆï¼Œä¸éœ€è¦é‡æ–° buildï¼›  
        ä½†å¦‚æœä¿®æ”¹çš„æ˜¯ C++ æˆ– interface (msg/srv/action)ï¼Œä¸€å®šè¦ colcon buildã€‚

        3. æ¯å€‹æ–° terminal éƒ½è¦åš `source install/setup.bash`ï¼Œæˆ–å¯åŠ é€² `~/.bashrc`ã€‚  
        ä»¥åŠæ¯æ¬¡ç·¨è­¯å®Œä¹Ÿå»ºè­°éƒ½åšä¸€æ¬¡ `source install/setup.bash`ã€‚

        4. è‹¥é‡åˆ°ç·¨è­¯éŒ¯èª¤ï¼Œå¯ç”¨ `colcon build --event-handlers console_direct+` å»çœ‹ error logã€‚

    !!! example "Checkpoint"

        1. æˆåŠŸç·¨è­¯ï¼Œä¸¦çœ‹åˆ°å·¥ä½œå€ä¸­ç”Ÿæˆçš„ `build/`, `install/` å’Œ `log/`ã€‚
        2. å°‡ `source install/setup.bash` æ”¾é€² `~/.bashrc` å…§ã€‚  
        æ¯é–‹å•Ÿæ–° terminal è¼¸å…¥ `ros2 pkg list | grep -E 'cpp_pubsub|py_pubsub'`ï¼Œæ‡‰èƒ½é¡¯ç¤ºå‡ºè‡ªå·±çš„å¥—ä»¶ã€‚

4. åŸ·è¡Œ ROS2 Nodeã€‚

    é–‹å•Ÿå…©å€‹ Terminalï¼Œåˆ†åˆ¥åŸ·è¡Œ `talker` èˆ‡ `listener`ï¼š

    === "Terminal 1"

        > é‹è¡Œ `talker` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_pubsub talker
            ```

        === "Python"

            ``` yaml
            ros2 run py_pubsub talker
            ```

    === "Terminal 2"

        > é‹è¡Œ `listener` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_pubsub listener
            ```

        === "Python"

            ``` yaml
            ros2 run py_pubsub listener
            ```
    
    !!! question "ä¸€å®šé–‹å•Ÿå…©å€‹çµ‚ç«¯æ©Ÿå—?"

        ä¸ç”¨ã€‚é ˆé–‹å•Ÿå…©å€‹çš„åŸå› æ˜¯ï¼Œç›®å‰çš„ ROS2 Node éƒ½æ˜¯æŒçºŒé‹ä½œçš„ç¨‹åºï¼Œæ‰€ä»¥é‹è¡Œå¾Œå°±ç„¡æ³•ç¹¼çºŒè¼¸å…¥æŒ‡ä»¤ã€‚  

        æˆ‘å€‘å¯ä»¥ä½¿ç”¨ `&` ä¾†ä½¿ç•¶å‰ç¨‹åºé€²å…¥èƒŒæ™¯åŸ·è¡Œï¼Œä¾‹å¦‚ï¼š`ros2 run cpp_pubsub talker &`ã€‚  
        é€™æ¨£æŒ‰ä¸‹ `ctrl+C` å¾Œä¹ŸæœƒæŒçºŒé‹ä½œï¼Œé€™é»å¯ä»¥ç”¨ `ps` æˆ– `jobs` ä¾†ç¢ºèªã€‚  
        è‹¥è¦çµ‚æ­¢è©²é€²ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨ `kill` æŒ‡ä»¤ï¼Œé€™äº›å°±ç•™çµ¦è®€è€…è‡ªè¡Œå¯¦è¸ã€‚


    !!! example "Checkpoint"

        é–‹å•Ÿå…©å€‹çµ‚ç«¯æ©Ÿï¼Œä¸¦ä¸”æˆåŠŸé‹è¡Œå…©å€‹ Nodeã€‚

5. topic ç›¸é—œå·¥å…·æ¸¬è©¦ã€‚

    | æŒ‡ä»¤                            | èªªæ˜                            |
    |----------------------------------|---------------------------------|
    | `ros2 topic list`               | æŸ¥çœ‹ç›®å‰æ‰€æœ‰ topic åç¨±         |
    | `ros2 topic echo /chatter`     | ç›£çœ‹ `/chatter` topic çš„å…§å®¹     |
    | `ros2 topic info /chatter`     | é¡¯ç¤º topic è³‡è¨Šï¼ˆå‹åˆ¥ã€pub/subï¼‰ |
    | `ros2 topic hz /chatter`       | é¡¯ç¤ºè¨Šæ¯é »ç‡                    |
    | `ros2 topic pub /chatter std_msgs/String "data: 'hello'"` | æ‰‹å‹•ç™¼é€ä¸€ç­†è¨Šæ¯                  |

    !!! example "Checkpoint"

        ä½¿ç”¨ä»¥ä¸Šæ‰€æœ‰çš„ topic æŒ‡ä»¤æ¸¬è©¦ã€‚

---

### 3-4. æ’°å¯« Service / Client

1. å»ºç«‹ Packageã€‚

    === "C++"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_cmake cpp_srvcli --dependencies rclcpp example_interfaces
        ```

    === "Python"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_python py_srvcli --dependencies rclpy example_interfaces
        ```

2. æ’°å¯« Service å’Œ Client Nodeã€‚

    !!! abstract

        `add_two_ints_server` æ˜¯ä¸€å€‹æœå‹™ç¯€é»ï¼Œæœƒæ¥æ”¶å…©å€‹æ•´æ•¸ï¼Œä¸¦å›å‚³å®ƒå€‘çš„ç¸½å’Œã€‚  
        `add_two_ints_client` æ˜¯ä¸€å€‹ç”¨ä¾†å‘¼å«è©²æœå‹™çš„ç¯€é»ï¼Œé€å‡ºè«‹æ±‚ä¸¦é¡¯ç¤ºå›å‚³çš„åŠ ç¸½çµæœã€‚

    æª”æ¡ˆæ¶æ§‹ï¼š

    === "C++"

        ``` yaml
        cpp_srvcli/
        â”œâ”€â”€ CMakeLists.txt                    # CMake ç·¨è­¯é…ç½®æª”
        â”œâ”€â”€ package.xml                       # ROS2 å¥—ä»¶è³‡è¨Šèˆ‡ä¾è³´è¨­å®š
        â””â”€â”€ src/
            â”œâ”€â”€ add_two_ints_client.cpp       # ç”¨æ–¼å‘¼å« service çš„ client node
            â””â”€â”€ add_two_ints_server.cpp       # æä¾›æœå‹™çš„ server node
        ```
    
    === "Python"

        ``` yaml
        py_srvcli/
        â”œâ”€â”€ package.xml                       # ROS2 å¥—ä»¶è³‡è¨Šèˆ‡ä¾è³´è¨­å®š
        â”œâ”€â”€ setup.py                          # Python å¥—ä»¶å®‰è£è…³æœ¬ï¼Œè¨­å®š console_scripts
        â”œâ”€â”€ setup.cfg                         # Python å®‰è£ç”¨çš„è¼”åŠ©è¨­å®šæª”ï¼ˆå¯é¸ï¼‰
        â”œâ”€â”€ resource/
        â”‚   â””â”€â”€ py_srvcli                     # ç”¨æ–¼æ¨™è¨˜ç‚º ROS2 å¥—ä»¶
        â””â”€â”€ py_srvcli/
            â”œâ”€â”€ __init__.py                   # ç©ºç™½å³å¯ï¼Œæ¨™è¨˜ç‚º Python æ¨¡çµ„
            â”œâ”€â”€ add_two_ints_client.py        # ç”¨æ–¼å‘¼å« service çš„ client node
            â””â”€â”€ add_two_ints_server.py        # æä¾›æœå‹™çš„ server node
        ```

    ç¨‹å¼ç¢¼ï¼š

    === "C++"

        === "ğŸ“„ `add_two_ints_server.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "example_interfaces/srv/add_two_ints.hpp"

            using AddTwoInts = example_interfaces::srv::AddTwoInts;
            using std::placeholders::_1;
            using std::placeholders::_2;

            class AddTwoIntsServer : public rclcpp::Node {
            public:
                AddTwoIntsServer() : Node("add_two_ints_server") {
                    service_ = create_service<AddTwoInts>(
                    "add_two_ints", std::bind(&AddTwoIntsServer::handle_add, this, _1, _2));
                }

            private:
                void handle_add(const std::shared_ptr<AddTwoInts::Request> request,
                                std::shared_ptr<AddTwoInts::Response> response) {
                    response->sum = request->a + request->b;
                    RCLCPP_INFO(this->get_logger(), "Received: %ld + %ld", request->a, request->b);
                }

                rclcpp::Service<AddTwoInts>::SharedPtr service_;
            };

            int main(int argc, char **argv) {
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<AddTwoIntsServer>());
                rclcpp::shutdown();
                return 0;
            }

            ```

        === "ğŸ“„ `add_two_ints_client.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "example_interfaces/srv/add_two_ints.hpp"

            using AddTwoInts = example_interfaces::srv::AddTwoInts;

            int main(int argc, char **argv) {
                rclcpp::init(argc, argv);
                auto node = rclcpp::Node::make_shared("add_two_ints_client");
                auto client = node->create_client<AddTwoInts>("add_two_ints");

                while (!client->wait_for_service(std::chrono::seconds(1))) {
                    RCLCPP_INFO(node->get_logger(), "Waiting for service...");
                }

                auto request = std::make_shared<AddTwoInts::Request>();
                request->a = 3;
                request->b = 7;

                auto result = client->async_send_request(request);
                if (rclcpp::spin_until_future_complete(node, result) 
                    rclcpp::FutureReturnCode::SUCCESS) {
                    RCLCPP_INFO(node->get_logger(), "Result: %ld", result.get()->sum);
                }

                rclcpp::shutdown();
                return 0;
            }
            ```

        === "ğŸ“„ `CMakeLists.txt`"

            ``` yaml linenums="1"
            find_package(ament_cmake REQUIRED)
            find_package(rclcpp REQUIRED)
            find_package(example_interfaces REQUIRED)

            add_executable(add_two_ints_server src/add_two_ints_server.cpp)
            add_executable(add_two_ints_client src/add_two_ints_client.cpp)

            ament_target_dependencies(add_two_ints_server rclcpp example_interfaces)
            ament_target_dependencies(add_two_ints_client rclcpp example_interfaces)

            install(TARGETS
                add_two_ints_server
                add_two_ints_client
                DESTINATION lib/${PROJECT_NAME}
            )

            ament_package()

            ```

        === "ğŸ“„ `package.xml`"

            ``` xml linenums="1"
            <?xml version="1.0"?>
            <package format="3">
                <name>cpp_srvcli</name>
                <version>0.0.0</version>
                <description>C++ service/client example</description>
                <maintainer email="your_email@example.com">Your Name</maintainer>
                <license>Apache License 2.0</license>

                <buildtool_depend>ament_cmake</buildtool_depend>
                <build_depend>rclcpp</build_depend>
                <build_depend>example_interfaces</build_depend>
                <exec_depend>rclcpp</exec_depend>
                <exec_depend>example_interfaces</exec_depend>

                <export>
                    <build_type>ament_cmake</build_type>
                </export>
            </package>
            ```

    === "Python"

        === "ğŸ“„ `add_two_ints_server.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from example_interfaces.srv import AddTwoInts

            class AddTwoIntsServer(Node):
                def __init__(self):
                    super().__init__('add_two_ints_server')
                    self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.handle_add)

                def handle_add(self, request, response):
                    self.get_logger().info(f"Received request: {request.a} + {request.b}")
                    response.sum = request.a + request.b
                    return response

            def main(args=None):
                rclpy.init(args=args)
                node = AddTwoIntsServer()
                rclpy.spin(node)
                rclpy.shutdown()

            if __name__ == '__main__':
                main()
            ```

        === "ğŸ“„ `add_two_ints_client.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from example_interfaces.srv import AddTwoInts

            class AddTwoIntsClient(Node):
                def __init__(self):
                    super().__init__('add_two_ints_client')
                    self.client = self.create_client(AddTwoInts, 'add_two_ints')
                    while not self.client.wait_for_service(timeout_sec=1.0):
                        self.get_logger().info('Waiting for service...')
                    self.send_request()

                def send_request(self):
                    req = AddTwoInts.Request()
                    req.a = 3
                    req.b = 5
                    future = self.client.call_async(req)
                    rclpy.spin_until_future_complete(self, future)
                    if future.result():
                        self.get_logger().info(f'Result: {future.result().sum}')

            def main(args=None):
                rclpy.init(args=args)
                node = AddTwoIntsClient()
                rclpy.shutdown()

            if __name__ == '__main__':
                main()
            ```

        === "ğŸ“„ `setup.py`"

            ``` py linenums="1"
            from setuptools import setup
            package_name = 'py_srvcli'

            setup(
                name=package_name,
                version='0.0.0',
                packages=[package_name],
                entry_points={
                    'console_scripts': [
                        'add_two_ints_server = py_srvcli.add_two_ints_server:main',
                        'add_two_ints_client = py_srvcli.add_two_ints_client:main',
                    ],
                },
                install_requires=['setuptools'],
                zip_safe=True,
                maintainer='your_name',
                description='Example Service/Client in Python',
            )
            ```

        === "ğŸ“„ `package.xml`"

            ```xml linenums="1"
            <?xml version="1.0"?>
            <package format="3">
                <name>cpp_srvcli</name>
                <version>0.0.0</version>
                <description>C++ service/client example</description>
                <maintainer email="your_email@example.com">Your Name</maintainer>
                <license>Apache License 2.0</license>

                <buildtool_depend>ament_cmake</buildtool_depend>
                <exec_depend>rclpy</exec_depend>
                <exec_depend>example_interfaces</exec_depend>

                <export>
                    <build_type>ament_cmake</build_type>
                </export>
            </package>
            ```

    !!! example "Checkpoint"

        ç†è§£ç¨‹å¼ç¢¼çš„æ¶µç¾©ã€‚

3. ä½¿ç”¨ `colcon` å·¥å…·ç·¨è­¯å·¥ä½œå€ã€‚

    === "C++"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select cpp_srvcli --symlink-install
        ```

    === "Python"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select py_srvcli --symlink-install
        ```

    ç·¨è­¯å®Œæˆå¾Œï¼Œä½¿ç”¨ `source` å®‰è£ç’°å¢ƒï¼š

    ``` yaml
    source install/setup.bash
    ```

4. åŸ·è¡Œ ROS2 Service Nodeã€‚

    é–‹å•Ÿå…©å€‹ Terminalï¼Œåˆ†åˆ¥åŸ·è¡Œ `add_two_ints_server` èˆ‡ `add_two_ints_client`ï¼š

    === "Terminal 1"

        > é‹è¡Œ `add_two_ints_server` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_srvcli add_two_ints_server
            ```

        === "Python"

            ``` yaml
            ros2 run py_srvcli add_two_ints_server
            ```

    === "Terminal 2"

        > é‹è¡Œ `add_two_ints_client` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_srvcli add_two_ints_client
            ```

        === "Python"

            ``` yaml
            ros2 run py_srvcli add_two_ints_client
            ```

    !!! example "Checkpoint"

        æˆåŠŸé‹è¡Œ service æœå‹™ç¯€é»ã€‚

5. service ç›¸é—œå·¥å…·æ¸¬è©¦ã€‚

    | æŒ‡ä»¤                            | èªªæ˜                            |
    |----------------------------------|---------------------------------|
    | `ros2 service list`               | æŸ¥çœ‹ç›®å‰æ‰€æœ‰ topic åç¨±         |
    | `ros2 service type /add_two_ints`     | æŸ¥è©¢æœå‹™å‹åˆ¥     |
    | `ros2 interface show example_interfaces/srv/AddTwoInts`     | æŸ¥è©¢å‹åˆ¥çµæ§‹  |

    !!! example "Checkpoint"

        æˆåŠŸæ¸¬è©¦æ‰€æœ‰ä»¥ä¸Š service æŒ‡ä»¤ã€‚

---

### 3-5. æ’°å¯« Action

!!! abstract "Action æ©Ÿåˆ¶"

    ROS 2 ä¸­çš„ Action æ˜¯ç”¨ä¾†è™•ç†**é•·æ™‚é–“é‹è¡Œä»»å‹™**çš„ä¸€ç¨®é€šè¨Šæ–¹å¼ï¼Œä¾‹å¦‚å°èˆªã€è¿½è¹¤ç­‰ã€‚å®ƒå…·æœ‰ä¸‰ç¨®äº’å‹•é¡å‹ï¼š

    - `goal`ï¼šç”¨ä¾†å‚³é€è«‹æ±‚é–‹å§‹ä»»å‹™
    - `feedback`ï¼šæœŸé–“æ€§å›å ±ç‹€æ…‹
    - `result`ï¼šæœ€çµ‚å›å‚³çµæœ
    - `cancel`ï¼šä¸­é€”å–æ¶ˆä»»å‹™ (Optional)

1. å»ºç«‹ Packageï¼š

    === "C++"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create cpp_action_example --build-type ament_cmake --dependencies rclcpp action_msgs
        ```

    === "Python"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create py_action_example --build-type ament_python --dependencies rclpy action_msgs
        ```

2. æ’°å¯« Service å’Œ Client Nodeã€‚

    !!! abstract

        `add_two_ints_server` æ˜¯ä¸€å€‹æœå‹™ç¯€é»ï¼Œæœƒæ¥æ”¶å…©å€‹æ•´æ•¸ï¼Œä¸¦å›å‚³å®ƒå€‘çš„ç¸½å’Œã€‚  
        `add_two_ints_client` æ˜¯ä¸€å€‹ç”¨ä¾†å‘¼å«è©²æœå‹™çš„ç¯€é»ï¼Œé€å‡ºè«‹æ±‚ä¸¦é¡¯ç¤ºå›å‚³çš„åŠ ç¸½çµæœã€‚

    æª”æ¡ˆæ¶æ§‹ï¼š

    === "C++"

        ``` yaml
        cpp_action_example/
        â”œâ”€â”€ action/
        â”‚   â””â”€â”€ Fibonacci.action
        â”œâ”€â”€ src/
        â”‚   â”œâ”€â”€ action_server.cpp
        â”‚   â””â”€â”€ action_client.cpp
        â”œâ”€â”€ CMakeLists.txt
        â””â”€â”€ package.xml
        ```

    === "Python"

        ``` yaml
        py_action_example/
        â”œâ”€â”€ action/
        â”‚   â””â”€â”€ Fibonacci.action
        â”œâ”€â”€ py_action_example/
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â”œâ”€â”€ action_server.py
        â”‚   â””â”€â”€ action_client.py
        â”œâ”€â”€ setup.py
        â”œâ”€â”€ package.xml
        â””â”€â”€ setup.cfg
        ```

    ç¨‹å¼ç¢¼ï¼š

    === "C++"

        === "ğŸ“„ `action_server.cpp`"

            ``` cpp linenums="1"
            #include <memory>
            #include <vector>
            #include <rclcpp/rclcpp.hpp>
            #include <rclcpp_action/rclcpp_action.hpp>
            #include "cpp_action_example/action/fibonacci.hpp"

            class FibonacciActionServer : public rclcpp::Node{
            public:
                using Fibonacci = cpp_action_example::action::Fibonacci;
                using GoalHandleFibonacci = rclcpp_action::ServerGoalHandle<Fibonacci>;

                explicit FibonacciActionServer(): Node("fibonacci_action_server"){
                    action_server_ = rclcpp_action::create_server<Fibonacci>(
                    this,
                    "fibonacci",
                    std::bind(&FibonacciActionServer::handle_goal, this, std::placeholders::_1, std::placeholders::_2),
                    std::bind(&FibonacciActionServer::handle_cancel, this, std::placeholders::_1),
                    std::bind(&FibonacciActionServer::handle_accepted, this, std::placeholders::_1));
                }

            private:
                rclcpp_action::Server<Fibonacci>::SharedPtr action_server_;

                rclcpp_action::GoalResponse handle_goal(
                    const rclcpp_action::GoalUUID &,
                    std::shared_ptr<const Fibonacci::Goal> goal){
                    RCLCPP_INFO(this->get_logger(), "Received goal: order = %d", goal->order);
                    return rclcpp_action::GoalResponse::ACCEPT_AND_EXECUTE;
                }

                rclcpp_action::CancelResponse handle_cancel(const std::shared_ptr<GoalHandleFibonacci> goal_handle){
                    RCLCPP_INFO(this->get_logger(), "Received cancel request");
                    return rclcpp_action::CancelResponse::ACCEPT;
                }

                void handle_accepted(const std::shared_ptr<GoalHandleFibonacci> goal_handle){
                    std::thread{std::bind(&FibonacciActionServer::execute, this, goal_handle)}.detach();
                }

                void execute(const std::shared_ptr<GoalHandleFibonacci> goal_handle){
                    RCLCPP_INFO(this->get_logger(), "Executing goal...");
                    const auto goal = goal_handle->get_goal();
                    auto feedback = std::make_shared<Fibonacci::Feedback>();
                    auto result = std::make_shared<Fibonacci::Result>();

                    feedback->partial_sequence = {0, 1};
                    rclcpp::Rate rate(1);
                    for (int i = 2; i < goal->order; ++i){
                    if (goal_handle->is_canceling()) {
                        goal_handle->canceled(result);
                        RCLCPP_INFO(this->get_logger(), "Goal canceled");
                        return;
                    }

                    feedback->partial_sequence.push_back(
                        feedback->partial_sequence[i - 1] + feedback->partial_sequence[i - 2]);
                        goal_handle->publish_feedback(feedback);
                        RCLCPP_INFO(this->get_logger(), "Feedback: %ld", feedback->partial_sequence.back());
                        rate.sleep();
                    }

                    result->sequence = feedback->partial_sequence;
                    goal_handle->succeed(result);
                    RCLCPP_INFO(this->get_logger(), "Goal succeeded");
                }
            };

            int main(int argc, char ** argv){
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<FibonacciActionServer>());
                rclcpp::shutdown();
                return 0;
            }
            ```

        === "ğŸ“„ `action_client.cpp`"

            ``` cpp linenums="1"

            #include <rclcpp/rclcpp.hpp>
            #include <rclcpp_action/rclcpp_action.hpp>
            #include "cpp_action_example/action/fibonacci.hpp"

            class FibonacciActionClient : public rclcpp::Node{
            public:
                using Fibonacci = cpp_action_example::action::Fibonacci;
                using GoalHandleFibonacci = rclcpp_action::ClientGoalHandle<Fibonacci>;

                explicit FibonacciActionClient(): Node("fibonacci_action_client"){
                    this->client_ptr_ = rclcpp_action::create_client<Fibonacci>(this, "fibonacci");
                    this->send_goal(10);
                }

                void send_goal(int order){
                    if (!client_ptr_->wait_for_action_server(std::chrono::seconds(5))) {
                        RCLCPP_ERROR(this->get_logger(), "Action server not available after waiting");
                        return;
                    }

                    auto goal_msg = Fibonacci::Goal();
                    goal_msg.order = order;

                    auto send_goal_options = rclcpp_action::Client<Fibonacci>::SendGoalOptions();
                    send_goal_options.feedback_callback = std::bind(&FibonacciActionClient::feedback_cb, this, std::placeholders::_1, std::placeholders::_2);
                    send_goal_options.result_callback = std::bind(&FibonacciActionClient::result_cb, this, std::placeholders::_1);

                    client_ptr_->async_send_goal(goal_msg, send_goal_options);
                }

            private:
                rclcpp_action::Client<Fibonacci>::SharedPtr client_ptr_;

                void feedback_cb(GoalHandleFibonacci::SharedPtr,
                                const std::shared_ptr<const Fibonacci::Feedback> feedback){
                    RCLCPP_INFO(this->get_logger(), "Feedback: %ld", feedback->partial_sequence.back());
                }

                void result_cb(const GoalHandleFibonacci::WrappedResult & result){
                    RCLCPP_INFO(this->get_logger(), "Result received.");
                    for (auto number : result.result->sequence) {
                        std::cout << number << " ";
                    }
                    std::cout << std::endl;
                    rclcpp::shutdown();
                }
            };

            int main(int argc, char ** argv){
                rclcpp::init(argc, argv);
                auto node = std::make_shared<FibonacciActionClient>();
                rclcpp::spin(node);
                return 0;
            }
            ```

        === "ğŸ“„ `CMakeLists.txt`"

            ``` yaml linenums="1"
            find_package(ament_cmake REQUIRED)
            find_package(rclcpp REQUIRED)
            find_package(rclcpp_action REQUIRED)
            find_package(builtin_interfaces REQUIRED 
            find_package(rosidl_default_generators REQUIRED)

            rosidl_generate_interfaces(${PROJECT_NAME}
                "action/Fibonacci.action"
                DEPENDENCIES builtin_interfaces
            )

            add_executable(action_server src/action_server.cpp)
            ament_target_dependencies(action_server rclcpp rclcpp_action)

            add_executable(action_client src/action_client.cpp)
            ament_target_dependencies(action_client rclcpp rclcpp_action)

            install(TARGETS
                action_server
                action_client
                DESTINATION lib/${PROJECT_NAME}
            )

            ament_package()
            ```

        === "ğŸ“„ `package.xml`"

            ``` xml linenums="1"
            <?xml version="1.0"?>
            <package format="3">
                <name>cpp_action_example</name>
                <version>0.0.1</version>
                <description>Fibonacci action example in C++ for ROS 2</description>

                <maintainer email="your_email@example.com">Your Name</maintainer>
                <license>Apache License 2.0</license>

                <!-- å»ºæ§‹æ™‚æ‰€éœ€çš„ä¾è³´ -->
                <buildtool_depend>ament_cmake</buildtool_depend>

                <build_depend>rclcpp</build_depend>
                <build_depend>rclcpp_action</build_depend>
                <build_depend>rosidl_default_generators</build_depend>

                <!-- åŸ·è¡Œæ™‚æ‰€éœ€çš„ä¾è³´ -->
                <exec_depend>rclcpp</exec_depend>
                <exec_depend>rclcpp_action</exec_depend>
                <exec_depend>rosidl_default_runtime</exec_depend>

                <!-- action æª”æ¡ˆæ”¯æ´ -->
                <member_of_group>rosidl_interface_packages</member_of_group>

                <export>
                    <build_type>ament_cmake</build_type>
                </export>
            </package>
            ```

    === "Python"

        === "ğŸ“„ `Fibonacci.action`"

            ``` yaml linenums="1"
            int32 order
            ---
            int32[] sequence
            ---
            int32[] partial_sequence
            ```

        === "ğŸ“„ `action_server.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from rclpy.action import ActionServer
            from py_action_example.action import Fibonacci

            class FibonacciActionServer(Node):
                def __init__(self):
                    super().__init__('fibonacci_action_server')
                    self._action_server = ActionServer(
                        self,
                        Fibonacci,
                        'fibonacci',
                        self.execute_callback
                    )

                async def execute_callback(self, goal_handle):
                    self.get_logger().info('Executing goal...')
                    result = Fibonacci.Result()
                    feedback_msg = Fibonacci.Feedback()
                    feedback_msg.partial_sequence = [0, 1]

                    for i in range(2, goal_handle.request.order):
                        feedback_msg.partial_sequence.append(
                            feedback_msg.partial_sequence[i - 1] + feedback_msg.partial_sequence[i - 2]
                        )
                        self.get_logger().info(f'Feedback: {feedback_msg.partial_sequence}')
                        goal_handle.publish_feedback(feedback_msg)
                        await rclpy.sleep(1)

                    result.sequence = feedback_msg.partial_sequence
                    goal_handle.succeed()
                    return result

            def main(args=None):
                rclpy.init(args=args)
                node = FibonacciActionServer()
                rclpy.spin(node)
                rclpy.shutdown()

            if __name__ == '__main__':
                main()
            ```
        === "ğŸ“„ `action_client.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from rclpy.action import ActionClient
            from py_action_example.action import Fibonacci

            class FibonacciActionClient(Node):
                def __init__(self):
                    super().__init__('fibonacci_action_client')
                    self._action_client = ActionClient(self, Fibonacci, 'fibonacci')

                def send_goal(self, order):
                    self._action_client.wait_for_server()
                    goal_msg = Fibonacci.Goal()
                    goal_msg.order = order

                    self._action_client.send_goal_async(goal_msg, feedback_callback=self.feedback_callback).add_done_callback(
                        self.goal_response_callback
                    )

                def goal_response_callback(self, future):
                    goal_handle = future.result()
                    if not goal_handle.accepted:
                        self.get_logger().info('Goal rejected')
                        return

                    self.get_logger().info('Goal accepted')
                    goal_handle.get_result_async().add_done_callback(self.result_callback)

                def feedback_callback(self, feedback_msg):
                    self.get_logger().info(f'Received feedback: {feedback_msg.feedback.partial_sequence}')

                def result_callback(self, future):
                    result = future.result().result
                    self.get_logger().info(f'Result: {result.sequence}')
                    rclpy.shutdown()

            def main(args=None):
                rclpy.init(args=args)
                action_client = FibonacciActionClient()
                action_client.send_goal(10)
                rclpy.spin(action_client)

            if __name__ == '__main__':
                main()
            ```

        === "ğŸ“„ `setup.py`"

            ``` py linenums="1"
            from setuptools import setup

            package_name = 'py_action_example'

            setup(
                name=package_name,
                version='0.0.0',
                packages=[package_name],
                install_requires=['setuptools'],
                zip_safe=True,
                maintainer='you',
                description='Example of ROS 2 action in Python',
                entry_points={
                    'console_scripts': [
                        'action_server = py_action_example.action_server:main',
                        'action_client = py_action_example.action_client:main',
                    ],
                },
            )
            ```

    !!! example "Checkpoint"

        ç†è§£ç¨‹å¼ç¢¼çš„æ¶µç¾©ã€‚

---

## 4. ROS Launch åŠŸèƒ½

!!! abstract "ROS2 Launch"

    ROS 2 Launch ç³»çµ±æä¾›ä¸€å¥—é«˜åº¦æ¨¡çµ„åŒ–çš„æ–¹å¼ï¼ŒåŒæ™‚å•Ÿå‹•å¤šå€‹ç¯€é»ã€è¼‰å…¥åƒæ•¸ã€å‘½åç©ºé–“åˆ†çµ„èˆ‡æ¢ä»¶å¼åŸ·è¡Œç­‰ã€‚  
    é€é Python Launch APIï¼Œå¯æ’°å¯«æ›´å…·å½ˆæ€§çš„å•Ÿå‹•è…³æœ¬ï¼Œä»¥æ”¯æ´é–‹ç™¼èˆ‡æ¸¬è©¦æµç¨‹ã€‚

### 4-1. åŸºæœ¬ç¯„ä¾‹

ç¾åœ¨å°‡å…ˆå‰çš„ Publisher-Subscriberã€Service-Clientã€Action ç¯„ä¾‹æ•´åˆé€²ä¸€å€‹ Launch æª”ï¼Œ  
æ–¹ä¾¿ä¸€æ¬¡å•Ÿå‹•å¤šå€‹ç¯€é»ã€‚  

å»ºç«‹ launch pkg ï¼š`ros2 pkg create all_launch_examples --build-type ament_python`ã€‚

> æª”æ¡ˆæ¶æ§‹ï¼š
    ``` yaml 
    colcon_ws/
    â”œâ”€â”€ build/
    â”œâ”€â”€ install/
    â”œâ”€â”€ log/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ cpp_pubsub/
    â”‚   â”œâ”€â”€ py_pubsub/
    â”‚   â”œâ”€â”€ cpp_srvcli/
    â”‚   â”œâ”€â”€ py_srvcli/
    â”‚   â”œâ”€â”€ cpp_action_example/
    â”‚   â”œâ”€â”€ py_action_example/
    â”‚   â””â”€â”€ all_launch_examples/    # launch package
    â”‚       â”œâ”€â”€ launch/
    â”‚       â”‚   â””â”€â”€ all_examples_launch.py
    â”‚       â”œâ”€â”€ package.xml
    â”‚       â”œâ”€â”€ setup.py
    â”‚       â”œâ”€â”€ setup.cfg
    â”‚       â””â”€â”€ resource/
    â”‚           â””â”€â”€ all_launch_examples

    ```

ç¨‹å¼ç¢¼ï¼š

=== "ğŸ“„ `all_launch_examples.py`"

    ``` py linenums="1"
    from launch import LaunchDescription
    from launch_ros.actions import Node

    def generate_launch_description():
        return LaunchDescription([
            # C++ Pub-Sub
            Node(package='cpp_pubsub', executable='talker', name='cpp_talker', output='screen'),
            Node(package='cpp_pubsub', executable='listener', name='cpp_listener', output='screen'),

            # Python Pub-Sub
            Node(package='py_pubsub', executable='talker', name='py_talker', output='screen'),
            Node(package='py_pubsub', executable='listener', name='py_listener', output='screen'),

            # C++ Service
            Node(package='cpp_srvcli', executable='add_two_ints_server', name='cpp_srv_server', output='screen'),
            Node(package='cpp_srvcli', executable='add_two_ints_client', name='cpp_srv_client', output='screen'),

            # Python Service
            Node(package='py_srvcli', executable='add_two_ints_server', name='py_srv_server', output='screen'),
            Node(package='py_srvcli', executable='add_two_ints_client', name='py_srv_client', output='screen'),

            # C++ Action
            Node(package='cpp_action_example', executable='action_server', name='cpp_action_server', output='screen'),
            Node(package='cpp_action_example', executable='action_client', name='cpp_action_client', output='screen'),

            # Python Action
            Node(package='py_action_example', executable='action_server', name='py_action_server', output='screen'),
            Node(package='py_action_example', executable='action_client', name='py_action_client', output='screen'),
        ])
    ```

=== "ğŸ“„ `setup.py`"

    ```py linenums="1"
    from setuptools import setup

    package_name = 'all_launch_examples'

    setup(
        name=package_name,
        version='0.0.0',
        packages=[package_name],
        data_files=[
            ('share/' + package_name, ['package.xml']),
            ('share/' + package_name + '/launch', ['launch/all_examples_launch.py']),
            ('share/ament_index/resource_index/packages', ['resource/' + package_name]),
        ],
        install_requires=['setuptools'],
        zip_safe=True,
        maintainer='your_name',
        maintainer_email='your_email@example.com',
        description='A launch package for pub-sub, service and action examples',
        license='Apache License 2.0',
    )
    ```

ç·¨è­¯èˆ‡åŸ·è¡Œï¼š

``` yaml
cd ~/colcon_ws
colcon build --packages-select all_launch_examples
source install/setup.bash

ros2 launch all_launch_examples all_examples_launch.py
```

??? question "å¦‚ä½•ç¢ºå®š YAML æ­£ç¢ºåŒ¯å…¥?"

    ä½¿ç”¨ CLIï¼š

    ```
    ros2 param list /cpp_talker_param
    ros2 param get /cpp_talker_param message_prefix
    ```

!!! example "Checkpoint"

    æˆåŠŸä¸€éµ launch æ‰€æœ‰ ROS2 Nodesã€‚

---

### 4-2. è¼‰å…¥ YAML åƒæ•¸

!!! abstract "è¼‰å…¥ YAML åƒæ•¸"

    åœ¨ ROS 2 ä¸­ï¼Œåƒæ•¸è¨­å®šå¯ä»¥é€é YAML æª”æ¡ˆé›†ä¸­ç®¡ç†ï¼Œä½¿ Launch æª”æ›´ç°¡æ½”ã€‚  
    é©ç”¨æ–¼ï¼šéœ€è¦å¤šæ¬¡èª¿æ•´åƒæ•¸çš„é–‹ç™¼éç¨‹ï¼Œæˆ–æ˜¯æœ‰å¤šçµ„é…ç½®æƒ…å¢ƒï¼ˆä¾‹å¦‚å¯¦æ©Ÿèˆ‡æ¨¡æ“¬ï¼‰çš„æ‡‰ç”¨ã€‚

> æª”æ¡ˆæ¶æ§‹ï¼š
    ``` yaml 
    all_launch_examples/
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ pub_params.yaml            # åƒæ•¸è¨­å®šæª”
    â”œâ”€â”€ launch/
    â”‚   â”œâ”€â”€ all_examples_launch.py
    â”‚   â””â”€â”€ talker_with_params.py      # ä½¿ç”¨åƒæ•¸çš„ launch
    â”œâ”€â”€ package.xml
    â”œâ”€â”€ setup.py
    â”œâ”€â”€ setup.cfg
    â””â”€â”€ resource/
        â””â”€â”€ all_launch_examples
    ```

ç¨‹å¼ç¢¼ï¼š

=== "ğŸ“„ `pub_params.yaml`"

    ```py linenums="1"
    cpp_pubsub:
    ros__parameters:
        message_prefix: "Hello from CPP"
        publish_frequency: 2.0

    py_pubsub:
    ros__parameters:
        message_prefix: "Hello from Python"
        publish_frequency: 1.0
    ```

=== "ğŸ“„ `talker_with_params.py`"

    ``` py linenums="1"
    from launch import LaunchDescription
    from launch_ros.actions import Node

    def generate_launch_description():
        return LaunchDescription([
            Node(
                package='cpp_pubsub',
                executable='talker',
                name='cpp_talker_param',
                parameters=['config/pub_params.yaml'],
                output='screen'
            ),
            Node(
                package='py_pubsub',
                executable='talker',
                name='py_talker_param',
                parameters=['config/pub_params.yaml'],
                output='screen'
            )
        ])
    ```

=== "ğŸ“„ `setup.py`"

    ``` py linenums="1"
    from setuptools import setup

    package_name = 'all_launch_examples'

    setup(
        name=package_name,
        version='0.0.0',
        packages=[package_name],
        data_files=[
            ('share/' + package_name, ['package.xml']),
            ('share/' + package_name + '/launch', [
                'launch/all_examples_launch.py',
                'launch/talker_with_params.py'
            ]),
            ('share/' + package_name + '/config', ['config/pub_params.yaml']),
            ('share/ament_index/resource_index/packages', ['resource/' + package_name]),
        ],
        install_requires=['setuptools'],
        zip_safe=True,
        maintainer='your_name',
        maintainer_email='your_email@example.com',
        description='A launch package for pub-sub, service and action examples',
        license='Apache License 2.0',
    )
    ```

ç·¨è­¯èˆ‡åŸ·è¡Œï¼š

``` yaml
cd ~/colcon_ws
colcon build --packages-select all_launch_examples
source install/setup.bash

ros2 launch all_launch_examples talker_with_params.py
```

!!! example "Checkpoint"

    1. æˆåŠŸè¼‰å…¥ YAML åƒæ•¸è‡³å°æ‡‰ç¯€é»ã€‚
    2. å¦‚ä½•ç¢ºèª publish_frequency æ˜¯å¦ç‚º yaml ä¸­çš„è¨­ç½®é »ç‡?

---

### 4-3. Launch Arguments

!!! abstract "Launch Arguments ç°¡ä»‹"

    Launch Arguments æ˜¯åœ¨ ROS 2 Launch ç³»çµ±ä¸­ç”¨ä¾†è®“ä½¿ç”¨è€…åœ¨å•Ÿå‹•æ™‚å‚³éåƒæ•¸çš„æ©Ÿåˆ¶ï¼Œ  
    ä½¿å¾—åŒä¸€ä»½ Launch æª”å¯æ ¹æ“šä¸åŒéœ€æ±‚ï¼Œå‹•æ…‹èª¿æ•´ç¯€é»åƒæ•¸ã€åŸ·è¡Œè¡Œç‚ºæˆ–å•Ÿå‹•æ¢ä»¶ã€‚  
    é©ç”¨æ–¼éœ€è¦å½ˆæ€§é…ç½®ã€ç’°å¢ƒåˆ‡æ›æˆ–å¤šç¨®åŸ·è¡Œæ¨¡å¼çš„å ´æ™¯ã€‚

å¯¦ä½œé€é Launch Args æ±ºå®šæ˜¯å¦å•Ÿå‹• `py_talker` ç¯€é»ï¼Œä¸¦ä¸”æŒ‡å®šåƒæ•¸ `message_prefix`ï¼š

=== "ğŸ“„ `launch/launch_args_example.py`"

    ``` py linenums="1"
    from launch import LaunchDescription
    from launch.actions import DeclareLaunchArgument, LogInfo
    from launch.substitutions import LaunchConfiguration
    from launch_ros.actions import Node

    def generate_launch_description():
        # å®£å‘Šå…©å€‹ launch argumentsï¼š
        #   use_py_talker: boolï¼Œæ±ºå®šæ˜¯å¦å•Ÿå‹• py_talker
        #   prefix: å‚³çµ¦ py_talker çš„ message_prefix åƒæ•¸
        use_py_talker_arg = DeclareLaunchArgument(
            'use_py_talker',
            default_value='true',
            description='Whether to launch py_talker node'
        )
        prefix_arg = DeclareLaunchArgument(
            'prefix',
            default_value='Hello from launch args!',
            description='Message prefix parameter for py_talker'
        )

        use_py_talker = LaunchConfiguration('use_py_talker')
        prefix = LaunchConfiguration('prefix')

        # å®šç¾©ç¯€é»ï¼Œä½†åŒ…åœ¨æ¢ä»¶ä¸­ï¼Œåªæœ‰ use_py_talker æ˜¯ true æ™‚æ‰å•Ÿå‹•
        py_talker_node = Node(
            package='py_pubsub',
            executable='talker',
            name='py_talker_arg',
            output='screen',
            parameters=[{'message_prefix': prefix}]
        )

        return LaunchDescription([
            use_py_talker_arg,
            prefix_arg,
            LogInfo(msg=['use_py_talker = ', use_py_talker]),
            LogInfo(msg=['prefix = ', prefix]),
            # ä½¿ç”¨ Python æ¢ä»¶åˆ¤æ–·ä¾†æ§åˆ¶æ˜¯å¦åŠ å…¥ç¯€é»
            # LaunchDescription ä¸æ”¯æ´ if else ç›´æ¥åŠ å…¥ç¯€é»ï¼Œæ‰€ä»¥ç”¨ Condition æˆ– Python API å‹•æ…‹æ§åˆ¶
            py_talker_node if use_py_talker.perform({}) == 'true' else None
        ])
    ```

ç·¨è­¯ï¼š

``` yaml
cd ~/colcon_ws
colcon build --packages-select all_launch_examples
source install/setup.bash
```

åŸ·è¡Œï¼š

=== "ä½¿ç”¨é è¨­åƒæ•¸"

    ``` yaml
    ros2 launch all_launch_examples launch_args_example.py
    ```

=== "å‚³å…¥è‡ªè¨‚åƒæ•¸"

    ``` yaml 
    ros2 launch all_launch_examples launch_args_example.py use_py_talker:=false prefix:="Custom Prefix"
    ```

???+ tip " Launch Args vs. YAML"

    | é …ç›®            | Launch Arguments                        | YAML åƒæ•¸æª”                             |
    | ------------- | --------------------------------------- | ------------------------------------ |
    | **ç”¨é€”**        | åœ¨å•Ÿå‹•æ™‚å‹•æ…‹è¨­å®šåƒæ•¸                              | å®šç¾©éœæ…‹åƒæ•¸ï¼Œé›†ä¸­ç®¡ç†å¤šå€‹åƒæ•¸                      |
    | **è¨­å®šæ–¹å¼**      | CLI æˆ– launch æª”å…§</br>`DeclareLaunchArgument` | YAML æª”æ¡ˆæ’°å¯« +</br> `Node(parameters=[...])` |
    | **æ”¯æ´å‹åˆ¥**      | é€šå¸¸ç‚ºå­—ä¸²ï¼Œéœ€æ‰‹å‹•è½‰æ›å‹åˆ¥                           | æ”¯æ´å­—ä¸²ã€æ•´æ•¸ã€æµ®é»ã€</br>å¸ƒæ—ã€List ç­‰åŸç”Ÿå‹åˆ¥             |
    | **å¯æ”œæ€§ / æ˜“è®€æ€§** | ä¸æ˜“é‡è¤‡ä½¿ç”¨ï¼Œç¶­è­·æˆæœ¬é«˜                            | çµæ§‹æ¸…æ¥šï¼Œä¾¿æ–¼ç‰ˆæœ¬æ§åˆ¶èˆ‡é‡è¤‡ä½¿ç”¨                     |
    | **å½ˆæ€§**        | é«˜ï¼šå¯æ­é… CLI å‚³åƒã€æ¢ä»¶æ§åˆ¶ã€</br>å‘½åç©ºé–“åˆ‡æ›                | ä¸­ï¼šä¾æ“šæª”æ¡ˆåˆ‡æ›ï¼Œ</br>å½ˆæ€§å–æ±ºæ–¼ç¨‹å¼å…§è®€å–é‚è¼¯                |
    | **å…¸å‹ä½¿ç”¨å ´æ™¯**    | è¼•é‡åƒæ•¸åˆ‡æ›ã€æ¢ä»¶å¼å•Ÿå‹•ã€</br>debug æ¨¡å¼é–‹é—œ                 | æ¨¡çµ„åŒ–è¨­å®šï¼ˆå¤§é‡åƒæ•¸ï¼‰ã€</br>å¤šæ©Ÿåƒæ•¸é…ç½®                   |
    | **å¯å¦æ­é… CLI**  | âœ… `ros2 launch pkg file.py arg:=value`  | âœ… å¯è®€å–å›ºå®š YAML æª”æ¡ˆ</br>ï¼ˆä½† CLI ä¸æ”¯æ´å‹•æ…‹ä¿®æ”¹ï¼‰       |
    | **åƒæ•¸ä½œç”¨å°è±¡**    | å¯ç”¨æ–¼æ§åˆ¶ç¯€é»æ˜¯å¦å•Ÿå‹•ã€åƒæ•¸å€¼                         | é€šå¸¸æ˜¯å‚³å…¥ç¯€é»å…§éƒ¨çš„ ros\_\_parameters         |

!!! example "Checkpoint"

    å­¸æœƒä½¿ç”¨ Launch Argumentsã€‚
