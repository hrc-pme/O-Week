# ROS2

## 1. ROS2 åŸºç¤ä»‹ç´¹

---

### 1-1. ROS ç°¡ä»‹

ROSï¼ˆRobot Operating Systemï¼‰æ˜¯ä¸€å¥—ç‚ºæ©Ÿå™¨äººé–‹ç™¼æ‰€è¨­è¨ˆçš„ä¸­ä»‹è»Ÿé«”æ¶æ§‹ï¼Œ  
æä¾›å¸¸ç”¨å·¥å…·èˆ‡åŠŸèƒ½ï¼Œä¾‹å¦‚é€šè¨Šã€ç¡¬é«”æŠ½è±¡ã€æ¨¡çµ„åŒ–æ¶æ§‹ç­‰ã€‚

ROS2 æ¯å€‹[ç™¼è¡Œç‰ˆï¼ˆdistroï¼‰](https://docs.ros.org/en/dashing/Releases.html)éƒ½å°æ‡‰ç‰¹å®šçš„ Ubuntu ç‰ˆæœ¬ï¼Œ  
å»ºè­°é¸ç”¨ LTSï¼ˆLong Term Supportï¼‰ç‰ˆæœ¬ä»¥ç²å¾—è¼ƒé•·çš„ç¶­è­·èˆ‡ç©©å®šæ€§ã€‚

| ROS2 Distro   | æ”¯æ´ Ubuntu ç‰ˆæœ¬      | LTS æ”¯æ´æœŸé™         |
|---------------|----------------------|----------------------|
| Foxy          | 20.04 (Focal, LTS)   | 2023/05              |
| Galactic      | 20.04 (Focal, LTS)   | 2022/11              |
| Humble        | 22.04 (Jammy, LTS)   | 2027/05 (LTS)        |
| Iron          | 22.04 (Jammy, LTS)   | 2024/11              |
| Jazzy         | 24.04 (Noble, LTS)   | 2029/05 (LTS)        |

!!! tip "ROS Distro é¸æ“‡"

    é–‹ç™¼å°ˆæ¡ˆå„ªå…ˆé¸æ“‡ ROS2 LTS ç‰ˆæœ¬ï¼ˆå¦‚ Humbleã€Jazzyï¼‰åŠå°æ‡‰çš„ Ubuntu LTS ç‰ˆæœ¬ï¼Œä»¥ç¢ºä¿é•·æœŸæ”¯æ´èˆ‡ç›¸å®¹æ€§ã€‚

??? info "ROS1 vs. ROS2"

    ROS1 é›–ç„¶å»£æ³›ä½¿ç”¨ï¼Œä½†åœ¨å¯é æ€§ã€å®‰å…¨æ€§ã€å³æ™‚æ€§ã€å¤šå¹³å°æ”¯æ´ç­‰æ–¹é¢æœ‰æ˜é¡¯é™åˆ¶ã€‚  
    ROS2 å‰‡æ˜¯é‡å°é€™äº›ç¼ºé»é€²è¡Œé‡æ§‹ï¼Œä¸¦å°å…¥äº†å·¥æ¥­ç•Œæ¨™æº–çš„ DDS æ¶æ§‹ã€‚

    **ROS1 èˆ‡ ROS2 çš„å·®ç•°æ¯”è¼ƒï¼š**

    | ç‰¹æ€§             | ROS1                          | ROS2                              |
    |------------------|-------------------------------|-----------------------------------|
    | é€šè¨Šæ©Ÿåˆ¶         | åŸºæ–¼ TCP/UDP è‡ªè¨‚å”å®š         | åŸºæ–¼ DDS æ¨™æº–                     |
    | å¤šå¹³å°æ”¯æ´       | åƒ…æ”¯æ´ Linux ç‚ºä¸»              | æ”¯æ´ Linuxã€Windowsã€macOS       |
    | å¯¦æ™‚æ€§æ”¯æ´       | ä¸æ”¯æ´                         | å¯é€é DDS è¨­å®šå¯¦ç¾åŸºæœ¬å¯¦æ™‚æ€§    |
    | å®‰å…¨æ€§           | å¹¾ä¹ç„¡å…§å»ºå®‰å…¨æ€§               | DDS æä¾›åŠ å¯†èˆ‡å­˜å–æ§åˆ¶æ©Ÿåˆ¶       |
    | æ¨¡çµ„å•Ÿå‹•èˆ‡æ§åˆ¶   | ä¸æ”¯æ´ Lifecycle               | æ”¯æ´ Lifecycle èˆ‡ç‹€æ…‹æ©Ÿ           |

    é›–ç„¶ ROS2 æ”¯æ´ Linux ä»¥å¤–çš„ OSï¼Œ ä½†é‚„æ˜¯ç›¡é‡è·‘åœ¨ Linux OSã€‚

---

### 1-2. ROS2 æ ¸å¿ƒæ¦‚å¿µ

| æ ¸å¿ƒæ¦‚å¿µ                | èªªæ˜                                                                 |
|-------------------------|--------------------------------------------------------------------|
| Node                | ROS2 ä¸­çš„æœ€å°é‹ä½œå–®å…ƒï¼Œè² è²¬è™•ç†ç‰¹å®šä»»å‹™ã€‚                           |
| Topic            | éåŒæ­¥è³‡æ–™æµã€‚</br>Publisher èˆ‡ Subscriber ç”¨ä¾†å‚³é€èˆ‡æ¥æ”¶è³‡æ–™ã€‚           |
| Service             | åŒæ­¥é€šè¨Šæ©Ÿåˆ¶ã€‚</br>ç”± Client ç™¼é€è«‹æ±‚ã€Server å›æ‡‰ã€‚                      |
| Action             | é©åˆé•·æ™‚é–“åŸ·è¡Œçš„ä»»å‹™ï¼Œå…·å‚™å›å ±ä¸­é–“ç‹€æ…‹èˆ‡å–æ¶ˆçš„èƒ½åŠ›ã€‚                 |
| Publisher / Subscriber | ä¸€å°å¤šæˆ–å¤šå°å¤šçš„è¨Šæ¯ç™¼å¸ƒèˆ‡è¨‚é–±ã€‚                                 |
| tf2 åº§æ¨™è½‰æ›ç³»çµ±    | ç®¡ç†å¤šç¨®åæ¨™ç³»ä¹‹é–“çš„é—œä¿‚èˆ‡è½‰æ›ã€‚                                    |
| Parameter           | å¯åœ¨åŸ·è¡Œæ™‚å‹•æ…‹è¨­å®šèˆ‡èª¿æ•´çš„è®Šæ•¸ã€‚                                    |
| Lifecycle          | æä¾›ç¯€é»ç”Ÿå‘½é€±æœŸç®¡ç†çš„æ©Ÿåˆ¶ï¼Œæœ‰åŠ©æ–¼ç³»çµ±å•Ÿå‹•èˆ‡é‡å•Ÿæ§åˆ¶ã€‚               |

---

### 1-3. ROS2 Middleware

![](../assets/ros2/arch.jpg){width="700"}

* **DDS (Data Distribution Service)**ï¼š

    - ROS2 çš„é è¨­ä¸­ä»‹ç³»çµ±ï¼ˆä¾‹å¦‚ Fast DDSã€Cyclone DDS ç­‰ï¼‰
    - æ”¯æ´ QoSï¼ˆQuality of Serviceï¼‰è¨­å®šï¼Œå¦‚å¯é æ€§ã€å»¶é²ã€ä¿ç•™æ­·å²ç­‰
    - åˆ†æ•£å¼æ¶æ§‹ï¼Œä¸éœ€ä¸­å¤® Master ç®¡ç†

* **RMWï¼ˆROS Middleware Interfaceï¼‰å±¤**ï¼š

    - æŠ½è±¡å±¤ï¼Œæä¾› ROS2 èˆ‡ DDS çš„ä»‹æ¥
    - å…è¨±ä¸åŒ DDS å¯¦ä½œï¼ˆå¦‚ Fast DDSã€RTI Connextï¼‰åˆ‡æ›è€Œä¸æ›´æ”¹ä¸Šå±¤ç¨‹å¼ç¢¼

---

## 2. ç’°å¢ƒæº–å‚™

!!! abstract "é–‹ç™¼é ˆçŸ¥"

    æ‰€æœ‰çš„è»Ÿé«”éƒ½å¿…é ˆä½¿ç”¨ Docker é–‹ç™¼ï¼Œä¸è¦ç›´æ¥åœ¨ Host Machine ä¸Šå®‰è£å¥—ä»¶ã€‚

---

### 2-1. ROS2 Docker

é¦–å…ˆæ˜¯ ROS å®˜æ–¹æä¾›çš„ Image æœ‰ä»¥ä¸‹å¹¾ç¨®ç‰ˆæœ¬ã€‚  

å­¸ç¿’éšæ®µï¼Œå¯ä»¥ä½¿ç”¨ `ros:humble-desktop-full` é¿å…ç¼ºå°‘ä¾è³´å¥—ä»¶çš„éŒ¯èª¤ã€‚  
ä½†é–‹ç™¼éšæ®µï¼Œè€ƒæ…®åˆ° Docker æ¸›è‚¥ï¼Œæœ€å¥½æ˜¯å¾ `ros:<distro>-base` é–‹å§‹å®‰è£å¿…è¦å·¥å…·ã€‚


!!! info "ROS2 Official"

    | Image åç¨±                  | å…§å®¹ç°¡ä»‹                                                         | é©ç”¨æƒ…å¢ƒ                   |
    |-----------------------------|------------------------------------------------------------------|----------------------------|
    | `ros:<distro>-base`         | åƒ…å«æœ€åŸºç¤çš„ ROS å®‰è£                                            | è‡ªè¨‚éœ€æ±‚ã€æœ€å°åŒ–æ˜ åƒæª”     |
    | `ros:<distro>-core`        | å«é–‹ç™¼å·¥å…·èˆ‡ç·¨è­¯å™¨                                               | Package é–‹ç™¼               |
    | `ros:<distro>-desktop`      | å« GUI å·¥å…·ï¼ˆå¦‚ RVizï¼‰                                           | æ¨¡æ“¬ã€ä¸€èˆ¬é–‹ç™¼             |
    | `ros:<distro>-desktop-full` | å®Œæ•´ç‰ˆæœ¬ã€‚</br>å«æ¨¡æ“¬å™¨ï¼ˆå¦‚ Gazeboï¼‰ã€ç¯„ä¾‹å¥—ä»¶ç­‰                    | éœ€è¦å®Œæ•´åŠŸèƒ½èˆ‡æ¨¡æ“¬ç’°å¢ƒ     |

??? info "ROS2 Official vs. osrf"

    é™¤äº†å®˜æ–¹ Imageï¼Œä¹Ÿå¯ä»¥åƒè€ƒçœ‹çœ‹ osrf çš„ç‰ˆæœ¬ã€‚

    | é …ç›®                   | ROS å®˜æ–¹ Docker Image (`ros:`)             | OSRF Docker Image (`osrf/ros:`)            |
    |------------------------|--------------------------------------------|--------------------------------------------|
    | ç¶­è­·å–®ä½               | Canonical & Open Roboticsï¼ˆå®˜æ–¹ï¼‰         | OSRFï¼ˆOpen Source Robotics Foundationï¼‰    |
    | Docker Hub ä½ç½®        | https://hub.docker.com/_/ros              | https://hub.docker.com/r/osrf/ros          |
    | ç™¼å¸ƒé »ç‡               | ç©©å®šã€å°é½Š ROS ç™¼å¸ƒç¯€å¥                   | æœ‰æ™‚æœƒæå‰æ¸¬è©¦æ–°ç‰ˆæœ¬                        |
    | æ”¯æ´ç‰ˆæœ¬               | å…¨ç‰ˆæœ¬</br>ï¼ˆbaseã€coreã€desktopã€fullï¼‰      | éƒ¨åˆ†ä»¥ `desktop` ç‚ºä¸»ï¼Œ</br>ä¹Ÿæœ‰ dev images     |
    | å®‰è£æ–¹å¼               | ä½¿ç”¨ `apt` å®‰è£ ROS å¥—ä»¶                  | æœ‰æ™‚ä½¿ç”¨ `rosinstall_generator` æˆ–è‡ªå»º      |
    | æ˜ åƒå¤§å°               | è¼ƒå°ï¼ˆè¦–ç‰ˆæœ¬è€Œå®šï¼‰                        | æœ‰æ™‚åŒ…å«å¤šé¤˜ dev å·¥å…·ï¼Œè¼ƒå¤§                |
    | é©åˆæƒ…å¢ƒ               | æ­£å¼é–‹ç™¼èˆ‡éƒ¨ç½²ç”¨                          | æ¸¬è©¦ã€CI/CDã€è‡ªè¨‚æ§‹å»ºéœ€æ±‚                   |
    | é¡åƒçµæ§‹               | åŸºæ–¼ Ubuntu å®˜æ–¹æ˜ åƒæ§‹å»º                  | æœ‰äº›ç‰ˆæœ¬æ˜¯å¤šéšæ®µæ§‹å»ºï¼Œåå‘é–‹ç™¼ç”¨é€”          |
    | æ–‡ä»¶èˆ‡èªªæ˜             | å®˜æ–¹ ROS Wikiã€Docker Hub</br>èªªæ˜å®Œæ•´        | ç›¸å°è¼ƒå°‘ã€éœ€æŸ¥ GitHub æˆ–ç¤¾ç¾¤èªªæ˜            |


!!! example "Checkpoint"

    é¸æ“‡ä¸€å€‹ ROS2 Docker Imageï¼Œä¸¦ä¸”é€²å…¥åˆ° Container å…§æº–å‚™é–‹ç™¼ã€‚  
    ç‚ºäº†å­¸ç¿’æ–¹ä¾¿ï¼Œè«‹åœ¨ docker compose ä¸­ volume ç©ºè³‡æ–™å¤¾åˆ° container å…§éƒ¨ï¼š`~/colcon_ws:/root/colcon_ws` ã€‚  
    å¦‚æœä¸æœƒæ“ä½œï¼Œè«‹å›é ­åƒé–± [docker-compose](http://localhost:8000/hrc-tech-docs/oweek/4.docker/#4-docker-compose)ã€‚

---

### 2-2. ROS2 Workspace æ¦‚å¿µ

ROS2 ä½¿ç”¨å·¥ä½œå€ï¼ˆworkspaceï¼‰ä¾†ç®¡ç†ç¨‹å¼ç¢¼èˆ‡å¥—ä»¶ï¼Œæœ€åŸºæœ¬çš„çµæ§‹å¦‚ä¸‹ï¼š

``` yaml
ros2_ws/                # ROS2 å·¥ä½œå€ä¸»ç›®éŒ„
â”œâ”€â”€ build/              # ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰colcon å»ºæ§‹ä¸­é–“ç”¢ç‰©ï¼ˆCMake build filesï¼‰
â”œâ”€â”€ install/            # ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰å®‰è£å¾Œçš„åŸ·è¡Œæª”èˆ‡è¨­å®šæª”ï¼ˆsource æ­¤è³‡æ–™å¤¾ä»¥ä½¿ç”¨å¥—ä»¶ï¼‰
â”œâ”€â”€ log/                # ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰å»ºæ§‹éç¨‹çš„æ—¥èªŒï¼ˆç·¨è­¯éŒ¯èª¤èˆ‡è¼¸å‡ºç´€éŒ„ï¼‰
â””â”€â”€ src/                # åŸå§‹ç¢¼æ”¾ç½®è™•ï¼šæ”¾ç½® ROS2 packages
    â”œâ”€â”€ my_robot_pkg/   # è‡ªè¨‚æˆ–ä¸‹è¼‰çš„ ROS2 package
    â””â”€â”€ example_pkg/    # å¯ä»¥æœ‰å¤šå€‹ ROS2 packages
```

å†å¾€ä¸‹è¿½æº¯åˆ° ROS2 Package çš„å…§éƒ¨çµæ§‹ï¼Œä¹Ÿæ˜¯éµå¾ªè‘—ä¸€å®šçš„æ¶æ§‹ã€‚  
ROS2 Package å¯ç”¨ `C++` æˆ–æ˜¯ `Python` èªè¨€æ’°å¯«ï¼Œæª”æ¡ˆæ¶æ§‹ä¸Šæœƒæœ‰äº›è¨±ä¸åŒï¼š

=== "ğŸ“„ `C++ Package æ¶æ§‹`"

    ``` yaml
    cpp_robot_pkg/
    â”œâ”€â”€ CMakeLists.txt                  # ROS2 CMake å»ºæ§‹è…³æœ¬ï¼Œç·¨è­¯èˆ‡å®‰è£è¦å‰‡å®šç¾©
    â”œâ”€â”€ package.xml                     # ROS2 å¥—ä»¶æè¿°æª”ï¼Œå®£å‘Šä¾è³´ã€ä½œè€…ç­‰è³‡è¨Š
    â”œâ”€â”€ launch/
    â”‚   â””â”€â”€ cpp_robot.launch.py         # ä½¿ç”¨ Python æ’°å¯«çš„å•Ÿå‹•æª”ï¼Œå•Ÿå‹•ç¯€é»ç”¨
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ cpp_robot_node.cpp          # ç¯€é»ä¸»ç¨‹å¼ (C++ æ’°å¯«)ï¼Œé€šå¸¸å« main()
    â”œâ”€â”€ include/
    â”‚   â””â”€â”€ cpp_robot_pkg/
    â”‚       â””â”€â”€ cpp_robot_node.hpp      # å°æ‡‰çš„ C++ æ¨™é ­æª”ï¼Œå®šç¾©é¡åˆ¥èˆ‡ä»‹é¢
    â””â”€â”€ config/
        â””â”€â”€ params.yaml                 # åƒæ•¸æª”ï¼Œä¾›ç¯€é»åœ¨å•Ÿå‹•æ™‚è¼‰å…¥è¨­å®šå€¼
    ```

=== "ğŸ“„ `Python Package æ¶æ§‹`"

    ``` yaml
    py_robot_pkg/
    â”œâ”€â”€ package.xml                 # ROS2 å¥—ä»¶æè¿°æª”ï¼Œå®£å‘Šä¾è³´ã€åŸ·è¡Œé»ã€æˆæ¬Šç­‰
    â”œâ”€â”€ setup.py                    # Python å®‰è£è…³æœ¬ï¼Œå®£å‘Šå¥—ä»¶çµæ§‹èˆ‡ entry_points
    â”œâ”€â”€ setup.cfg                   # è£œå……è¨­å®šæª”ï¼Œç°¡åŒ– setup.py çš„æ ¼å¼å®šç¾©
    â”œâ”€â”€ resource/
    â”‚   â””â”€â”€ py_robot_pkg            # ament æ‰€éœ€ï¼Œç”¨ä¾†æ¨™ç¤ºç‚ºå¯ç™¼ä½ˆå¥—ä»¶ï¼ˆç©ºæª”å³å¯ï¼‰
    â”œâ”€â”€ py_robot_pkg/
    â”‚   â”œâ”€â”€ __init__.py             # Python å¥—ä»¶åˆå§‹åŒ–ï¼ˆå¯ç•™ç©ºï¼‰
    â”‚   â””â”€â”€ py_robot_node.py        # ç¯€é»ä¸»ç¨‹å¼ (Python æ’°å¯«)ï¼Œå« rclpy ç¨‹å¼ç¢¼
    â”œâ”€â”€ launch/
    â”‚   â””â”€â”€ py_robot.launch.py      # å•Ÿå‹•æª”ï¼Œå®šç¾©å¦‚ä½•å•Ÿå‹•æ­¤ Python ç¯€é»
    â””â”€â”€ config/
        â””â”€â”€ params.yaml             # åƒæ•¸è¨­å®šæª”ï¼Œä»¥ YAML æ ¼å¼å®šç¾©åƒæ•¸å€¼
    ```

!!! warning "ROS2 ç·¨è­¯å·¥å…· colcon"
    
    æ³¨æ„ä»¥ä¸Šæ–‡ä»¶ä¸­æœ‰å¾ˆå¤šæ˜¯ä¾é  ROS2 çš„ç·¨è­¯å·¥å…· `colcon` å»ºç«‹æˆ–ç·¨è­¯çš„ç”¢ç‰©ï¼Œ  
    å› æ­¤è«‹è·Ÿè‘—æ­¥é©Ÿä½¿ç”¨å·¥å…·å»ºç«‹æª”æ¡ˆï¼Œè€Œä¸è¦è‡ªå·±å¾’æ‰‹æ–°å¢æª”æ¡ˆï¼Œå¦å‰‡å¯èƒ½æœƒç·¨è­¯æˆ–åŸ·è¡ŒéŒ¯èª¤ã€‚  

!!! example "Checkpoint"

    ç†è§£ Workspace æ¶æ§‹ï¼Œä¸¦ä¸”èƒ½åˆ†è¾¨ `workspace/src` å’Œ `package/src` çš„å·®ç•°ã€‚

---

## 3. ROS2 åŸºç¤åŠŸèƒ½å¯¦ä½œ

!!! abstract "å¯¦ä½œå…§å®¹"

    å¾ä¹¾æ·¨çš„ ROS2 Workspace æ­å»ºä¸åŒåŠŸèƒ½çš„ Nodeï¼Œä¸¦ç·¨è­¯ã€åŸ·è¡Œã€‚

---

### 3-1. å»ºç«‹ Workspace

!!! warning "ä½ å·²ç¶“åœ¨ Container å…§äº†å—?"

    å¾ŒçºŒæ“ä½œéƒ½æ˜¯åœ¨ Docker Container å…§åŸ·è¡Œï¼Œä¸è¦æ±™æŸ“åˆ°å®¿ä¸»æ©Ÿç’°å¢ƒï¼

å»ºç«‹ Workspace ç›®éŒ„ï¼š

``` yaml
mkdir -p ~/colcon_ws/src
src ~/colcon_ws
```

---

### 3-2. æ’°å¯« Publisher / Subscriber Node

1. å»ºç«‹ Packageï¼Œä»¥ä¸‹åˆ†ç‚º C++ å’Œ Python å…©ç¨®ç‰ˆæœ¬ï¼š

    === "C++"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_cmake py_pubsub --dependencies rclcpp std_msgs
        ```

    === "Python"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_python py_pubsub --dependencies rclpy std_msgs
        ```

2. æ’°å¯« Publisher å’Œ Subscriber Nodeï¼Œä¹Ÿæä¾› C++ å’Œ Python ç‰ˆæœ¬ï¼š

    !!! abstract

        talker å°‡å®šæ™‚ç™¼ä½ˆ message åˆ° topic ä¸Šé¢ï¼Œä¸¦ä¸”ç”± listener æ¥æ”¶è©² topicã€‚

    === "C++"

        === "ğŸ“„ `cpp_pubsub/src/talker.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "std_msgs/msg/string.hpp"
            #include <chrono>

            using namespace std::chrono_literals;

            class Talker : public rclcpp::Node {
            public:
                Talker() : Node("talker_node") {
                    publisher_ = this->create_publisher<std_msgs::msg::String>("chatter", 10);
                    timer_ = this->create_wall_timer(500ms, std::bind(&Talker::timer_callback, this));
                }

            private:
                void timer_callback() {
                    auto msg = std_msgs::msg::String();
                    msg.data = "Hello, ROS2!";
                    RCLCPP_INFO(this->get_logger(), "Publishing: '%s'", msg.data.c_str());
                    publisher_->publish(msg);
                }

                rclcpp::Publisher<std_msgs::msg::String>::SharedPtr publisher_;
                rclcpp::TimerBase::SharedPtr timer_;
            };

            int main(int argc, char *argv[]) {
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<Talker>());
                rclcpp::shutdown();
                return 0;
            }

            ```

        === "ğŸ“„ `cpp_pubsub/src/listener.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "std_msgs/msg/string.hpp"

            class Listener : public rclcpp::Node {
            public:
                Listener() : Node("listener_node") {
                    subscription_ = this->create_subscription<std_msgs::msg::String>(
                    "chatter", 10,
                    [this](const std_msgs::msg::String::SharedPtr msg) {
                        RCLCPP_INFO(this->get_logger(), "Received: '%s'", msg->data.c_str());
                    });
                }

            private:
                rclcpp::Subscription<std_msgs::msg::String>::SharedPtr subscription_;
            };

            int main(int argc, char *argv[]) {
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<Listener>());
                rclcpp::shutdown();
                return 0;
            }
            ```
    === "Python"

        === "ğŸ“„ `py_pubsub/src/talker.cpp`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from std_msgs.msg import String

            class Talker(Node):
                def __init__(self):
                    super().__init__('talker_node')
                    self.publisher_ = self.create_publisher(String, 'chatter', 10)
                    self.timer = self.create_timer(0.5, self.timer_callback)

                def timer_callback(self):
                    msg = String()
                    msg.data = 'Hello from Python!'
                    self.get_logger().info(f'Publishing: "{msg.data}"')
                    self.publisher_.publish(msg)

            def main(args=None):
                rclpy.init(args=args)
                node = Talker()
                rclpy.spin(node)
                node.destroy_node()
                rclpy.shutdown()

            if __name__ == '__main__':
                main()

            ```

        === "ğŸ“„ `py_pubsub/src/listener.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from std_msgs.msg import String

            class Listener(Node):
                def __init__(self):
                    super().__init__('listener_node')
                    self.subscription = self.create_subscription(
                        String,
                        'chatter',
                        self.listener_callback,
                        10)

                def listener_callback(self, msg):
                    self.get_logger().info(f'Received: "{msg.data}"')

            def main(args=None):
                rclpy.init(args=args)
                node = Listener()
                rclpy.spin(node)
                node.destroy_node()
                rclpy.shutdown()

            if __name__ == '__main__':
                main()

            ```

3. ä½¿ç”¨ `colcon` å·¥å…·ç·¨è­¯å·¥ä½œå€ã€‚

    === "C++"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select cpp_pubsub --symlink-install
        ```

    === "Python"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select py_pubsub --symlink-install
        ```

    ç·¨è­¯å®Œæˆå¾Œï¼Œä½¿ç”¨ `source` å®‰è£ç’°å¢ƒï¼š

    ``` yaml
    source install/setup.bash
    ```

4. åŸ·è¡Œ ROS2 Nodeã€‚

    é–‹å•Ÿå…©å€‹ Terminalï¼Œåˆ†åˆ¥åŸ·è¡Œ `talker` èˆ‡ `listener`ï¼š

    === "Terminal 1"

        é‹è¡Œ `talker` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_pubsub talker
            ```

        === "Python"

            ``` yaml
            ros2 run py_pubsub talker
            ```

    === "Terminal 2"

        é‹è¡Œ `listener` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_pubsub listener
            ```

        === "Python"

            ``` yaml
            ros2 run py_pubsub listener
            ```

5. topic ç›¸é—œå·¥å…·æ¸¬è©¦ã€‚

    | æŒ‡ä»¤                            | èªªæ˜                            |
    |----------------------------------|---------------------------------|
    | `ros2 topic list`               | æŸ¥çœ‹ç›®å‰æ‰€æœ‰ topic åç¨±         |
    | `ros2 topic echo /chatter`     | ç›£çœ‹ `/chatter` topic çš„å…§å®¹     |
    | `ros2 topic info /chatter`     | é¡¯ç¤º topic è³‡è¨Šï¼ˆå‹åˆ¥ã€pub/subï¼‰ |
    | `ros2 topic hz /chatter`       | é¡¯ç¤ºè¨Šæ¯é »ç‡                    |
    | `ros2 topic pub /chatter std_msgs/String "data: 'hello'"` | æ‰‹å‹•ç™¼é€ä¸€ç­†è¨Šæ¯                  |

---

### 3-4. æ’°å¯« Service / Client

1. å»ºç«‹ Packageï¼Œä»¥ä¸‹åˆ†ç‚º C++ å’Œ Python å…©ç¨®ç‰ˆæœ¬ï¼š

    === "C++"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_cmake cpp_srvcli --dependencies rclcpp example_interfaces
        ```

    === "Python"

        ``` yaml
        # :~/colcon_ws$
        cd src
        ros2 pkg create --build-type ament_python py_srvcli --dependencies rclpy example_interfaces
        ```

2. æ’°å¯« Service å’Œ Client Nodeï¼Œæä¾› C++ å’Œ Python ç‰ˆæœ¬ï¼š

    !!! abstract

        `add_two_ints_server` æ˜¯ä¸€å€‹æœå‹™ç¯€é»ï¼Œæœƒæ¥æ”¶å…©å€‹æ•´æ•¸ï¼Œä¸¦å›å‚³å®ƒå€‘çš„ç¸½å’Œã€‚
        `add_two_ints_client` æ˜¯ä¸€å€‹ç”¨ä¾†å‘¼å«è©²æœå‹™çš„ç¯€é»ï¼Œé€å‡ºè«‹æ±‚ä¸¦é¡¯ç¤ºå›å‚³çš„åŠ ç¸½çµæœã€‚

    === "C++"

        === "ğŸ“„ `cpp_srvcli/src/add_two_ints_server.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "example_interfaces/srv/add_two_ints.hpp"

            using AddTwoInts = example_interfaces::srv::AddTwoInts;
            using std::placeholders::_1;
            using std::placeholders::_2;

            class AddTwoIntsServer : public rclcpp::Node {
            public:
                AddTwoIntsServer() : Node("add_two_ints_server") {
                    service_ = create_service<AddTwoInts>(
                    "add_two_ints", std::bind(&AddTwoIntsServer::handle_add, this, _1, _2));
                }

            private:
                void handle_add(const std::shared_ptr<AddTwoInts::Request> request,
                                std::shared_ptr<AddTwoInts::Response> response) {
                    response->sum = request->a + request->b;
                    RCLCPP_INFO(this->get_logger(), "Received: %ld + %ld", request->a, request->b);
                }

                rclcpp::Service<AddTwoInts>::SharedPtr service_;
            };

            int main(int argc, char **argv) {
                rclcpp::init(argc, argv);
                rclcpp::spin(std::make_shared<AddTwoIntsServer>());
                rclcpp::shutdown();
                return 0;
            }

            ```

        === "ğŸ“„ `cpp_srvcli/src/add_two_ints_client.cpp`"

            ``` cpp linenums="1"
            #include "rclcpp/rclcpp.hpp"
            #include "example_interfaces/srv/add_two_ints.hpp"

            using AddTwoInts = example_interfaces::srv::AddTwoInts;

            int main(int argc, char **argv) {
                rclcpp::init(argc, argv);
                auto node = rclcpp::Node::make_shared("add_two_ints_client");
                auto client = node->create_client<AddTwoInts>("add_two_ints");

                while (!client->wait_for_service(std::chrono::seconds(1))) {
                    RCLCPP_INFO(node->get_logger(), "Waiting for service...");
                }

                auto request = std::make_shared<AddTwoInts::Request>();
                request->a = 3;
                request->b = 7;

                auto result = client->async_send_request(request);
                if (rclcpp::spin_until_future_complete(node, result) 
                    rclcpp::FutureReturnCode::SUCCESS) {
                    RCLCPP_INFO(node->get_logger(), "Result: %ld", result.get()->sum);
                }

                rclcpp::shutdown();
                return 0;
            }
            ```

    === "Python"

        === "ğŸ“„ `py_srvcli/srv/add_two_ints_server.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from example_interfaces.srv import AddTwoInts

            class AddTwoIntsServer(Node):
                def __init__(self):
                    super().__init__('add_two_ints_server')
                    self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.handle_add)

                def handle_add(self, request, response):
                    self.get_logger().info(f"Received request: {request.a} + {request.b}")
                    response.sum = request.a + request.b
                    return response

            def main(args=None):
                rclpy.init(args=args)
                node = AddTwoIntsServer()
                rclpy.spin(node)
                rclpy.shutdown()

            if __name__ == '__main__':
                main()
            ```

        === "ğŸ“„ `py_srvcli/srv/add_two_ints_client.py`"

            ``` py linenums="1"
            import rclpy
            from rclpy.node import Node
            from example_interfaces.srv import AddTwoInts

            class AddTwoIntsClient(Node):
                def __init__(self):
                    super().__init__('add_two_ints_client')
                    self.client = self.create_client(AddTwoInts, 'add_two_ints')
                    while not self.client.wait_for_service(timeout_sec=1.0):
                        self.get_logger().info('Waiting for service...')
                    self.send_request()

                def send_request(self):
                    req = AddTwoInts.Request()
                    req.a = 3
                    req.b = 5
                    future = self.client.call_async(req)
                    rclpy.spin_until_future_complete(self, future)
                    if future.result():
                        self.get_logger().info(f'Result: {future.result().sum}')

            def main(args=None):
                rclpy.init(args=args)
                node = AddTwoIntsClient()
                rclpy.shutdown()

            if __name__ == '__main__':
                main()
            ```

3. ä½¿ç”¨ `colcon` å·¥å…·ç·¨è­¯å·¥ä½œå€ã€‚

    === "C++"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select cpp_srvcli --symlink-install
        ```

    === "Python"

        ``` yaml
        cd ~/colcon_ws
        colcon build --packages-select py_srvcli --symlink-install
        ```

    ç·¨è­¯å®Œæˆå¾Œï¼Œä½¿ç”¨ `source` å®‰è£ç’°å¢ƒï¼š

    ``` yaml
    source install/setup.bash
    ```

4. åŸ·è¡Œ ROS2 Nodeã€‚

    é–‹å•Ÿå…©å€‹ Terminalï¼Œåˆ†åˆ¥åŸ·è¡Œ `add_two_ints_server` èˆ‡ `add_two_ints_client`ï¼š

    === "Terminal 1"

        é‹è¡Œ `add_two_ints_server` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run cpp_srvcli add_two_ints_server
            ```

        === "Python"

            ``` yaml
            ros2 run cpp_srvcli add_two_ints_client 1 2
            ```

    === "Terminal 2"

        é‹è¡Œ `add_two_ints_client` nodeã€‚

        === "C++"

            ``` yaml
            ros2 run py_srvcli add_two_ints_server
            ```

        === "Python"

            ``` yaml
            ros2 run py_srvcli add_two_ints_client 1 2
            ```

5. service ç›¸é—œå·¥å…·æ¸¬è©¦ã€‚

    | æŒ‡ä»¤                            | èªªæ˜                            |
    |----------------------------------|---------------------------------|
    | `ros2 service list`               | æŸ¥çœ‹ç›®å‰æ‰€æœ‰ topic åç¨±         |
    | `ros2 service type /add_two_ints`     | æŸ¥è©¢æœå‹™å‹åˆ¥     |
    | `ros2 interface show example_interfaces/srv/AddTwoInts`     | æŸ¥è©¢å‹åˆ¥çµæ§‹  |

---

### 3-5. æ’°å¯«èˆ‡ä½¿ç”¨ Action

* æ’°å¯« action server/client
* ä½¿ç”¨ ros2 action å·¥å…·è§€å¯Ÿ
* è§£é‡‹ goal/cancel/result æ©Ÿåˆ¶èˆ‡å›å‘¼

---

## 4. å»ºæ§‹é€²éš ROS2 å°ˆæ¡ˆæ¶æ§‹

---

### 4-1. æ’°å¯«å¤šç¯€é»æ¨¡çµ„åŒ–å°ˆæ¡ˆ

* å°ˆæ¡ˆçµæ§‹è¨­è¨ˆå»ºè­°ï¼ˆå¦‚ pkg_a/, pkg_b/ï¼‰
* å°‡ pub-sub, service, action æ‹†åˆ†ç‚ºä¸åŒåŠŸèƒ½æ¨¡çµ„
* ä½¿ç”¨ .msg, .srv, .action è‡ªè¨‚ä»‹é¢é¡å‹

### 4-2. æ’°å¯« Launch æª”

* Python launch file æ ¼å¼èˆ‡èªæ³•
* å¼•å…¥å¤šå€‹ç¯€é»èˆ‡ namespaceã€åƒæ•¸
* åŠ å…¥å»¶é²å•Ÿå‹•ã€æ¢ä»¶å•Ÿå‹•

### 4-3. å‹•æ…‹åƒæ•¸èˆ‡ Lifecycle ç®¡ç†

* ä½¿ç”¨ ROS2 Parameter
* å¼•å…¥ rclpy.parameter ç®¡ç†è¨­å®š
* ç°¡ä»‹ Lifecycle Node æ¦‚å¿µèˆ‡æ‡‰ç”¨æ™‚æ©Ÿ